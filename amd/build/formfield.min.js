define("customfield_sprogramme/formfield",["exports","customfield_sprogramme/manager","customfield_sprogramme/history","core/templates","core/str","core/modal","core/modal_events","customfield_sprogramme/local/repository"],(function(_exports,_manager,_history,_templates,_str,_modal,_modal_events,_repository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module formfield
   *
   * @module     customfield_sprogramme/formfield
   * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_manager=_interopRequireDefault(_manager),_history=_interopRequireDefault(_history),_templates=_interopRequireDefault(_templates),_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events),_repository=_interopRequireDefault(_repository);const showHistory=async(element,courseid,rfcid)=>{await getProgrammeHistory(element,courseid,rfcid);const modalContent=document.querySelector('[data-region="history"]');(await _modal.default.create({large:!0,title:(0,_str.getString)("history","customfield_sprogramme"),body:modalContent,show:!0})).getModal()[0].classList.add("modal-customfield_sprogramme_history")},getEditor=async(element,courseid)=>{await getProgramme(element,courseid);const modalContent=document.querySelector('[data-region="app"]'),modal=await _modal.default.create({large:!0,title:(0,_str.getString)("editprogramme","customfield_sprogramme"),body:modalContent,show:!0});modal.getRoot().on(_modal_events.default.hidden,(async()=>{const saveEvent=new CustomEvent("saveprogrammconfirm",{bubbles:!0});document.dispatchEvent(saveEvent)}));const saveButton=document.createElement("div"),modalElement=modal.getModal()[0];modalElement.classList.add("modal-customfield_sprogramme_editor");const header=modalElement.querySelector('[data-region="header"]'),title=modalElement.querySelector('[data-region="title"]');title&&header.insertBefore(saveButton,title.nextSibling);const{html:html,js:js}=await _templates.default.renderForPromise("customfield_sprogramme/table/savebutton",{courseid:courseid});await _templates.default.replaceNode(saveButton,html,js);header.querySelector('[data-action="closeform"]').addEventListener("click",(()=>{modal.hide()}));header.querySelector('[data-action="programme-download-csv"]').addEventListener("click",(async event=>{downloadCSV(courseid),event.preventDefault()}));header.querySelector('[data-action="saveconfirm"]').addEventListener("click",(async event=>{const saveEvent=new CustomEvent("saveconfirm",{bubbles:!0});document.dispatchEvent(saveEvent),event.preventDefault()}))},downloadCSV=async courseid=>{const csv=await _repository.default.csvData({courseid:courseid}),blob=new Blob([csv.csv],{type:"text/csv"}),url=window.URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download=csv.filename,a.click(),window.URL.revokeObjectURL(url)},getProgramme=async(element,courseid)=>{_manager.default.init(element,courseid)},getProgrammeHistory=async(element,courseid,rfcid)=>{_history.default.init(element,courseid,rfcid)};var _default={init:async()=>{document.addEventListener("click",(async event=>{const editaction=event.target.closest('[data-action="editprogramme"]');if(editaction){const courseid=editaction.dataset.courseid;await getEditor(editaction,courseid),event.preventDefault()}const submittedaction=event.target.closest('[data-action="showrfc-submitted"]');if(submittedaction){const courseid=submittedaction.dataset.courseid;await getEditor(submittedaction,courseid),event.preventDefault()}const acceptedaction=event.target.closest('[data-action="showrfc-accepted"]');if(acceptedaction){const courseid=acceptedaction.dataset.courseid,adminid=acceptedaction.dataset.adminid;await showHistory(acceptedaction,courseid,adminid),event.preventDefault()}}))}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=formfield.min.js.map