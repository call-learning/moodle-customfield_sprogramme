{"version":3,"file":"tagmanager.min.js","sources":["../src/tagmanager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module tagmanager\n *\n * @module     customfield_sprogramme/tagmanager\n * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport State from 'customfield_sprogramme/local/state';\nimport Repository from 'customfield_sprogramme/local/repository';\nimport Templates from 'core/templates';\nimport {getString} from 'core/str';\n\nclass TagManager {\n\n    modules = [];\n\n    tempTags = [];\n\n    /**\n     * Constructor.\n     */\n    constructor() {\n        this.addEventListeners();\n        this.fetchTags();\n    }\n\n    /**\n     * Set the modules.\n     * @param {Array} modules The modules.\n     */\n    async setModules(modules) {\n        this.modules = modules;\n    }\n\n    /**\n     * Fetch the tags.\n     */\n    async fetchTags() {\n        const tags = await Repository.getTags();\n        State.setValue('tags', tags);\n    }\n\n    /**\n     * Add event listeners.\n     */\n    addEventListeners() {\n        document.addEventListener('click', (e) => {\n            let btn = e.target.closest('[data-region=\"app\"] [data-action]');\n            if (btn) {\n                e.preventDefault();\n                this.actions(btn);\n            }\n        });\n    }\n\n    /**\n     * Handle actions.\n     * @param {HTMLElement} btn The button.\n     */\n    actions(btn) {\n        const actionMap = {\n            'adddisc': this.showDisciplineForm,\n            'addcomp': this.showCompetenciesForm,\n            'removetag': this.removeTag,\n            'closetagform': this.closeTagForm,\n            'selecttag': this.selectTag,\n            'tag-confirm': this.addTag,\n            'loadtag': this.loadTag,\n            'savetags': this.saveTags,\n        };\n        const action = btn.dataset.action;\n        if (actionMap[action]) {\n            actionMap[action].call(this, btn);\n        }\n    }\n\n    /**\n     * Get the position of a row in a module\n     * if the row is within the first 8 rows, return the rowid of the first row.\n     * if the row is the 8th row or higher, return the rowid of the row minus 8.\n     * @param {String} rowId The row id.\n     * @returns {Int} The rowId of the target row.\n     */\n    getTargetRow(rowId) {\n        const modules = State.getValue('modules');\n        if (!modules || modules.length === 0) {\n            return 0;\n        }\n\n        for (const module of modules) {\n            const rowFound = module.rows.find(row => row.id === parseInt(rowId));\n            if (rowFound) {\n                const position = module.rows.indexOf(rowFound);\n                if (position < 6) {\n                    const row = module.rows[0];\n                    return row ? row.id : 0;\n                } else {\n                    return module.rows[position - 6].id;\n                }\n            }\n        }\n        return 0; // Row not found in any module.\n    }\n\n    /**\n     * Get the number of pixels to shift the arrow downwards.\n     * @param {String} rowId The row id.\n     * @param {Int} position The position of the row the form is attached to.\n     * @param {String} type The type of tag (disciplines or competencies).\n     * @returns {Int} The number of pixels to shift the arrow downwards.\n     */\n    getRowOffset(rowId, position, type) {\n        if (parseInt(rowId) === position || position === 0) {\n            return 0; // No offset needed if the row is the target row.\n        }\n        const target = document.querySelector(`[data-${type}][data-rowid=\"${position}\"]`);\n        const row = document.querySelector(`[data-${type}][data-rowid=\"${rowId}\"]`);\n        if (!target || !row) {\n            return 0; // If the target or row is not found, no offset needed.\n        }\n        const targetRect = target.getBoundingClientRect();\n        const rowRect = row.getBoundingClientRect();\n        // Calculate the offset based on the target and row positions.\n        const offset = rowRect.top - targetRect.top;\n        return offset;\n    }\n\n    /**\n     * Get the row from the state.\n     * @param {int} rowid The rowid.\n     */\n    getRow(rowid) {\n        const modules = State.getValue('modules');\n        // Combine all rows in one array.\n        const rows = modules.reduce((acc, module) => {\n            return acc.concat(module.rows);\n        }, []);\n        const row = rows.find(r => r.id == rowid);\n        return row;\n    }\n\n    /**\n     * Get the tags from the current row.\n     * @param {String} rowId The row id.\n     * @param {String} type The type of tags to get.\n     */\n    getTagsFromRow(rowId, type) {\n        const row = this.getRow(rowId);\n        if (!row || !row[type]) {\n            return [];\n        }\n        // Set all tags to have nopop attribute to avoid popover.\n        row[type].forEach(tag => {\n            tag.nopop = true; // This will prevent the popover from showing.\n        });\n        return row[type];\n    }\n\n    /**\n     * Show the discipline form.\n     * @param {HTMLElement} btn The button.\n     */\n    async showDisciplineForm(btn) {\n        const rowId = btn.dataset.id;\n        this.closeTagForm();\n        this.renderForm(rowId, 'disciplines');\n    }\n\n    /**\n     * Show the competencies form.\n     * @param {HTMLElement} btn The button.\n     */\n    async showCompetenciesForm(btn) {\n        const rowId = btn.dataset.id;\n        this.closeTagForm();\n        this.renderForm(rowId, 'competencies');\n    }\n\n    /**\n     * Render the form\n     * @param {Number} rowId The row id.\n     * @param {String} type The type of tag to render.\n     * @returns {Promise<String>} The rendered form.\n     */\n    async renderForm(rowId, type) {\n        const setTags = this.getTagsFromRow(rowId, type);\n        // Clone the setTags to this.tempTags to avoid modifying the original setTags.\n        this.tempTags = [...setTags];\n        const position = this.getTargetRow(rowId);\n        const arrowOffset = this.getRowOffset(rowId, position, type);\n        const tags = State.getValue('tags');\n        const target = document.querySelector(`[data-${type}][data-rowid=\"${position}\"]`);\n        const maxTagsReached = this.isMaxTagsReached(type);\n        const {html, js} = await Templates.renderForPromise('customfield_sprogramme/tagform', {\n            tagtype: type,\n            taglist: tags[type],\n            rowid: rowId,\n            settags: this.tempTags,\n            hasmaxtags: maxTagsReached,\n            arrowoffset: arrowOffset,\n        });\n        await Templates.appendNodeContents(target, html, js);\n    }\n\n    /**\n     * Check if the maximum number of tags is reached for the given type.\n     * @param {String} type The type of tag to render.\n     * @returns {boolean} True if the maximum number of tags is reached, false otherwise\n     */\n    isMaxTagsReached(type) {\n        const config = {\n            'disciplines': 3,\n            'competencies': 100,\n        };\n        return this.tempTags.length >= config[type];\n    }\n\n\n    /**\n     * Destroy the discipline form.\n     */\n    closeTagForm() {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        if (form) {\n            form.remove();\n        }\n    }\n\n    /**\n     * Set the tag form with the given discipline.\n     * @param {Object} tag The tag.\n     */\n    setTagForm(tag) {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        const setTags = this.tempTags;\n        if (!form) {\n            return;\n        }\n        const input = form.querySelector('input[type=\"search\"]');\n        if (input) {\n            input.value = tag.name;\n        }\n        const tagId = form.querySelector('#tag-id');\n        if (tagId) {\n            tagId.value = tag.id;\n        }\n        const select = form.querySelector('#tag-value');\n        // Get the percentage based on the number of setTags 100 for the first tag, 50 for the second tag, etc.\n        const percentage = setTags.length > 0 ? Math.floor(100 / (setTags.length + 1)) : 100;\n        if (select) {\n            select.value = percentage;\n            select.focus();\n        }\n    }\n\n    /**\n     * Select a tag.\n     * @param {HTMLElement} btn The button.\n     */\n    selectTag(btn) {\n        const option = btn.closest('[data-option]');\n        const tag = {\n            id: option.dataset.id,\n            name: option.textContent,\n        };\n        this.setTagForm(tag);\n    }\n\n    /**\n     * Get a tag from the State tags.\n     *\n     * @param {String} tagId The tag id.\n     * @param {String} type The type of tag to get.\n     * traverse the tags in the state and return the tag with the given id.\n     */\n    getTag(tagId, type) {\n        const tags = State.getValue('tags');\n        if (!tags || !tags[type]) {\n            return null;\n        }\n        // Construct a flat array of tags.\n        const flatTags = tags[type].reduce((acc, tag) => {\n            acc.push(tag);\n            if (tag.items && tag.items.length > 0) {\n                acc.push(...tag.items);\n            }\n            return acc;\n        }, []);\n        // Find the tag with the given id.\n        return flatTags.find(tag => tag.uniqueid === parseInt(tagId) || tag.id === parseInt(tagId));\n    }\n\n\n    /**\n     * Add a tag selected in the tagform.\n     */\n    async addTag() {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        const warnings = form.querySelector('[data-region=\"warnings\"]');\n        warnings.innerHTML = ''; // Clear previous warnings.\n        if (!form) {\n            return;\n        }\n\n        const rowId = form.dataset.rowid;\n        const type = form.dataset.type;\n        const tagId = parseInt(form.querySelector('#tag-id').value);\n        const tagValue = parseInt(form.querySelector('#tag-value').value);\n        const totalTags = this.tempTags.length;\n\n        const suggestedPercentage = Math.floor(100 / (totalTags + 1));\n\n        if (!tagId) {\n            return;\n        }\n\n        // Find name of the tag.\n        const selectedTag = this.getTag(tagId, type);\n        if (!selectedTag) {\n            return;\n        }\n\n        // Add the tag to the row.\n        const row = this.getRow(rowId);\n        if (!row) {\n            return;\n        }\n        if (!row[type]) {\n            row[type] = [];\n        }\n        // Check if the tag already exists in the row.\n        const existingTags = this.tempTags;\n        if (existingTags.some(tag => tag.id === tagId)) {\n            warnings.innerHTML = await getString('alreadyset', 'customfield_sprogramme');\n            return; // Tag already exists in the row.\n        }\n\n        if (this.isMaxTagsReached(type)) {\n            warnings.innerHTML = await getString('maxdisciplines', 'customfield_sprogramme');\n            return;\n        }\n\n        const tag = {\n            id: tagId,\n            name: selectedTag ? selectedTag.name : 'Unknown',\n            percentage: tagValue,\n            customPercentage: tagValue !== suggestedPercentage,\n            nopop: true,\n        };\n        this.tempTags.push(tag);\n        this.resetTagPercentages();\n\n        // Might need to avoid this. it hides the tag form.\n        this.reRenderSetTags();\n        this.disableFormInput(this.isMaxTagsReached(type));\n    }\n\n    /**\n     * Reset the tag percentages based on the number of tags.\n     */\n    resetTagPercentages() {\n        const totalTags = this.tempTags.length;\n        if (totalTags === 0) {\n            return; // No tags to reset.\n        }\n        // If there are custom percentages, we do not reset them.\n        if (this.tempTags.some(tag => tag.customPercentage)) {\n            return; // Do not reset percentages if any tag has a custom percentage.\n        }\n        const percentage = Math.floor(100 / totalTags);\n        this.tempTags.forEach(tag => {\n            tag.percentage = percentage;\n        });\n\n        // The total should always be 100, so we adjust the last tag's percentage.\n        if (totalTags > 0) {\n            this.tempTags[totalTags - 1].percentage = 100 - (percentage * (totalTags - 1));\n        }\n    }\n\n    /**\n     * Re-render the setTags in the tag form.\n     */\n    async reRenderSetTags() {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        if (!form) {\n            return;\n        }\n        const tagRegion = form.querySelector('[data-region=\"selected-tags\"]');\n        if (!tagRegion) {\n            return;\n        }\n        tagRegion.innerHTML = ''; // Clear existing tags.\n\n        for (const tag of this.tempTags) {\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/tag', tag);\n            await Templates.appendNodeContents(tagRegion, html, js);\n        }\n    }\n\n    /**\n     * Remove a tag from the row.\n     * @param {HTMLElement} btn The button.\n     */\n    async removeTag(btn) {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        const warnings = form.querySelector('[data-region=\"warnings\"]');\n        warnings.innerHTML = ''; // Clear previous warnings.\n        if (!form) {\n            return;\n        }\n        const type = form.dataset.type;\n        const rowId = parseInt(form.dataset.rowid);\n        const tagId = parseInt(btn.dataset.id);\n\n        const row = this.getRow(rowId);\n        if (!row || !row[type]) {\n            return;\n        }\n        // Remove the tags from the tempTags array.\n        this.tempTags = this.tempTags.filter(tag => tag.id !== parseInt(tagId));\n        this.resetTagPercentages();\n        this.reRenderSetTags();\n        this.disableFormInput(this.isMaxTagsReached(type));\n    }\n\n\n    /**\n     * Load a tag into the tag form.\n     * @param {HTMLElement} btn The button.\n     */\n    async loadTag(btn) {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        if (!form) {\n            return;\n        }\n        form.querySelector('#tag-id').value = btn.dataset.id;\n        form.querySelector('#tag-value').value = btn.dataset.percentage;\n        form.querySelector('#tag-name').value = btn.dataset.name;\n        form.querySelector('#tag-value').focus();\n    }\n\n    /**\n     * Save the tempTags to the row.\n     */\n    async saveTags() {\n        const modules = State.getValue('modules');\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        const warnings = form.querySelector('[data-region=\"warnings\"]');\n        warnings.innerHTML = ''; // Clear previous warnings.\n        if (!form) {\n            return;\n        }\n        const rowId = form.dataset.rowid;\n        const type = form.dataset.type;\n        const row = this.getRow(rowId);\n        const totalPercentage = this.tempTags.reduce((acc, tag) => acc + tag.percentage, 0);\n        if (totalPercentage !== 100 && totalPercentage !== 99) {\n            warnings.innerHTML = await getString('maxpercentage', 'customfield_sprogramme', (100 - totalPercentage));\n            return; // Total percentage does not equal 100.\n        }\n        if (!row) {\n            return;\n        }\n        row[type] = this.tempTags;\n        // Update the row in the state.\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Disable the form input.\n     * @param {boolean} disable Whether to disable the form input.\n     */\n    async disableFormInput(disable = true) {\n        const form = document.querySelector('[data-region=\"tagform\"]');\n        const warnings = form.querySelector('[data-region=\"warnings\"]');\n        warnings.innerHTML = ''; // Clear previous warnings.\n        if (!form) {\n            return;\n        }\n        const input = form.querySelector('#tag-name');\n        if (input) {\n            input.disabled = disable;\n        }\n        const value = form.querySelector('#tag-value');\n        if (value) {\n            value.disabled = disable;\n        }\n        const submit = form.querySelector('[data-action=\"tag-confirm\"]');\n        if (submit) {\n            submit.disabled = disable;\n        }\n        if (disable) {\n            warnings.innerHTML = await getString('maxdisciplines', 'customfield_sprogramme');\n        }\n    }\n}\nnew TagManager();\n"],"names":["constructor","addEventListeners","fetchTags","modules","tags","Repository","getTags","setValue","document","addEventListener","e","btn","target","closest","preventDefault","actions","actionMap","this","showDisciplineForm","showCompetenciesForm","removeTag","closeTagForm","selectTag","addTag","loadTag","saveTags","action","dataset","call","getTargetRow","rowId","State","getValue","length","module","rowFound","rows","find","row","id","parseInt","position","indexOf","getRowOffset","type","querySelector","targetRect","getBoundingClientRect","top","getRow","rowid","reduce","acc","concat","r","getTagsFromRow","forEach","tag","nopop","renderForm","setTags","tempTags","arrowOffset","maxTagsReached","isMaxTagsReached","html","js","Templates","renderForPromise","tagtype","taglist","settags","hasmaxtags","arrowoffset","appendNodeContents","form","remove","setTagForm","input","value","name","tagId","select","percentage","Math","floor","focus","option","textContent","getTag","push","items","uniqueid","warnings","innerHTML","tagValue","totalTags","suggestedPercentage","selectedTag","some","customPercentage","resetTagPercentages","reRenderSetTags","disableFormInput","tagRegion","filter","totalPercentage","disable","disabled","submit"],"mappings":"0kBAoCIA,6CAPU,oCAEC,SAMFC,yBACAC,6BAOQC,cACRA,QAAUA,gCAOTC,WAAaC,oBAAWC,yBACxBC,SAAS,OAAQH,MAM3BH,oBACIO,SAASC,iBAAiB,SAAUC,QAC5BC,IAAMD,EAAEE,OAAOC,QAAQ,qCACvBF,MACAD,EAAEI,sBACGC,QAAQJ,SASzBI,QAAQJ,WACEK,UAAY,SACHC,KAAKC,2BACLD,KAAKE,+BACHF,KAAKG,uBACFH,KAAKI,uBACRJ,KAAKK,wBACHL,KAAKM,eACTN,KAAKO,iBACJP,KAAKQ,UAEfC,OAASf,IAAIgB,QAAQD,OACvBV,UAAUU,SACVV,UAAUU,QAAQE,KAAKX,KAAMN,KAWrCkB,aAAaC,aACH3B,QAAU4B,eAAMC,SAAS,eAC1B7B,SAA8B,IAAnBA,QAAQ8B,cACb,MAGN,MAAMC,UAAU/B,QAAS,OACpBgC,SAAWD,OAAOE,KAAKC,MAAKC,KAAOA,IAAIC,KAAOC,SAASV,YACzDK,SAAU,OACJM,SAAWP,OAAOE,KAAKM,QAAQP,aACjCM,SAAW,EAAG,OACRH,IAAMJ,OAAOE,KAAK,UACjBE,IAAMA,IAAIC,GAAK,SAEfL,OAAOE,KAAKK,SAAW,GAAGF,WAItC,EAUXI,aAAab,MAAOW,SAAUG,SACtBJ,SAASV,SAAWW,UAAyB,IAAbA,gBACzB,QAEL7B,OAASJ,SAASqC,8BAAuBD,8BAAqBH,gBAC9DH,IAAM9B,SAASqC,8BAAuBD,8BAAqBd,iBAC5DlB,SAAW0B,WACL,QAELQ,WAAalC,OAAOmC,+BACVT,IAAIS,wBAEGC,IAAMF,WAAWE,IAQ5CC,OAAOC,cACanB,eAAMC,SAAS,WAEVmB,QAAO,CAACC,IAAKlB,SACvBkB,IAAIC,OAAOnB,OAAOE,OAC1B,IACcC,MAAKiB,GAAKA,EAAEf,IAAMW,QASvCK,eAAezB,MAAOc,YACZN,IAAMrB,KAAKgC,OAAOnB,cACnBQ,KAAQA,IAAIM,OAIjBN,IAAIM,MAAMY,SAAQC,MACdA,IAAIC,OAAQ,KAETpB,IAAIM,OANA,4BAaUjC,WACfmB,MAAQnB,IAAIgB,QAAQY,QACrBlB,oBACAsC,WAAW7B,MAAO,0CAOAnB,WACjBmB,MAAQnB,IAAIgB,QAAQY,QACrBlB,oBACAsC,WAAW7B,MAAO,iCASVA,MAAOc,YACdgB,QAAU3C,KAAKsC,eAAezB,MAAOc,WAEtCiB,SAAW,IAAID,eACdnB,SAAWxB,KAAKY,aAAaC,OAC7BgC,YAAc7C,KAAK0B,aAAab,MAAOW,SAAUG,MACjDxC,KAAO2B,eAAMC,SAAS,QACtBpB,OAASJ,SAASqC,8BAAuBD,8BAAqBH,gBAC9DsB,eAAiB9C,KAAK+C,iBAAiBpB,OACvCqB,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAAiB,iCAAkC,CAClFC,QAASzB,KACT0B,QAASlE,KAAKwC,MACdM,MAAOpB,MACPyC,QAAStD,KAAK4C,SACdW,WAAYT,eACZU,YAAaX,oBAEXK,mBAAUO,mBAAmB9D,OAAQqD,KAAMC,IAQrDF,iBAAiBpB,aAKN3B,KAAK4C,SAAS5B,QAJN,aACI,eACC,KAEkBW,MAO1CvB,qBACUsD,KAAOnE,SAASqC,cAAc,2BAChC8B,MACAA,KAAKC,SAQbC,WAAWpB,WACDkB,KAAOnE,SAASqC,cAAc,2BAC9Be,QAAU3C,KAAK4C,aAChBc,kBAGCG,MAAQH,KAAK9B,cAAc,wBAC7BiC,QACAA,MAAMC,MAAQtB,IAAIuB,YAEhBC,MAAQN,KAAK9B,cAAc,WAC7BoC,QACAA,MAAMF,MAAQtB,IAAIlB,UAEhB2C,OAASP,KAAK9B,cAAc,cAE5BsC,WAAavB,QAAQ3B,OAAS,EAAImD,KAAKC,MAAM,KAAOzB,QAAQ3B,OAAS,IAAM,IAC7EiD,SACAA,OAAOH,MAAQI,WACfD,OAAOI,SAQfhE,UAAUX,WACA4E,OAAS5E,IAAIE,QAAQ,iBACrB4C,IAAM,CACRlB,GAAIgD,OAAO5D,QAAQY,GACnByC,KAAMO,OAAOC,kBAEZX,WAAWpB,KAUpBgC,OAAOR,MAAOrC,YACJxC,KAAO2B,eAAMC,SAAS,YACvB5B,OAASA,KAAKwC,aACR,YAGMxC,KAAKwC,MAAMO,QAAO,CAACC,IAAKK,OACrCL,IAAIsC,KAAKjC,KACLA,IAAIkC,OAASlC,IAAIkC,MAAM1D,OAAS,GAChCmB,IAAIsC,QAAQjC,IAAIkC,OAEbvC,MACR,IAEaf,MAAKoB,KAAOA,IAAImC,WAAapD,SAASyC,QAAUxB,IAAIlB,KAAOC,SAASyC,8BAQ9EN,KAAOnE,SAASqC,cAAc,2BAC9BgD,SAAWlB,KAAK9B,cAAc,+BACpCgD,SAASC,UAAY,IAChBnB,kBAIC7C,MAAQ6C,KAAKhD,QAAQuB,MACrBN,KAAO+B,KAAKhD,QAAQiB,KACpBqC,MAAQzC,SAASmC,KAAK9B,cAAc,WAAWkC,OAC/CgB,SAAWvD,SAASmC,KAAK9B,cAAc,cAAckC,OACrDiB,UAAY/E,KAAK4C,SAAS5B,OAE1BgE,oBAAsBb,KAAKC,MAAM,KAAOW,UAAY,QAErDf,mBAKCiB,YAAcjF,KAAKwE,OAAOR,MAAOrC,UAClCsD,yBAKC5D,IAAMrB,KAAKgC,OAAOnB,WACnBQ,WAGAA,IAAIM,QACLN,IAAIM,MAAQ,OAGK3B,KAAK4C,SACTsC,MAAK1C,KAAOA,IAAIlB,KAAO0C,oBACpCY,SAASC,gBAAkB,kBAAU,aAAc,8BAInD7E,KAAK+C,iBAAiBpB,kBACtBiD,SAASC,gBAAkB,kBAAU,iBAAkB,iCAIrDrC,IAAM,CACRlB,GAAI0C,MACJD,KAAMkB,YAAcA,YAAYlB,KAAO,UACvCG,WAAYY,SACZK,iBAAkBL,WAAaE,oBAC/BvC,OAAO,QAENG,SAAS6B,KAAKjC,UACd4C,2BAGAC,uBACAC,iBAAiBtF,KAAK+C,iBAAiBpB,OAMhDyD,4BACUL,UAAY/E,KAAK4C,SAAS5B,UACd,IAAd+D,oBAIA/E,KAAK4C,SAASsC,MAAK1C,KAAOA,IAAI2C,gCAG5BjB,WAAaC,KAAKC,MAAM,IAAMW,gBAC/BnC,SAASL,SAAQC,MAClBA,IAAI0B,WAAaA,cAIjBa,UAAY,SACPnC,SAASmC,UAAY,GAAGb,WAAa,IAAOA,YAAca,UAAY,kCAQzErB,KAAOnE,SAASqC,cAAc,+BAC/B8B,kBAGC6B,UAAY7B,KAAK9B,cAAc,oCAChC2D,WAGLA,UAAUV,UAAY,OAEjB,MAAMrC,OAAOxC,KAAK4C,SAAU,OACvBI,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAAiB,mCAAoCX,WAClFU,mBAAUO,mBAAmB8B,UAAWvC,KAAMC,sBAQ5CvD,WACNgE,KAAOnE,SAASqC,cAAc,8BACnB8B,KAAK9B,cAAc,4BAC3BiD,UAAY,IAChBnB,kBAGC/B,KAAO+B,KAAKhD,QAAQiB,KACpBd,MAAQU,SAASmC,KAAKhD,QAAQuB,OAC9B+B,MAAQzC,SAAS7B,IAAIgB,QAAQY,IAE7BD,IAAMrB,KAAKgC,OAAOnB,OACnBQ,KAAQA,IAAIM,aAIZiB,SAAW5C,KAAK4C,SAAS4C,QAAOhD,KAAOA,IAAIlB,KAAOC,SAASyC,cAC3DoB,2BACAC,uBACAC,iBAAiBtF,KAAK+C,iBAAiBpB,sBAQlCjC,WACJgE,KAAOnE,SAASqC,cAAc,2BAC/B8B,OAGLA,KAAK9B,cAAc,WAAWkC,MAAQpE,IAAIgB,QAAQY,GAClDoC,KAAK9B,cAAc,cAAckC,MAAQpE,IAAIgB,QAAQwD,WACrDR,KAAK9B,cAAc,aAAakC,MAAQpE,IAAIgB,QAAQqD,KACpDL,KAAK9B,cAAc,cAAcyC,gCAO3BnF,QAAU4B,eAAMC,SAAS,WACzB2C,KAAOnE,SAASqC,cAAc,2BAC9BgD,SAAWlB,KAAK9B,cAAc,+BACpCgD,SAASC,UAAY,IAChBnB,kBAGC7C,MAAQ6C,KAAKhD,QAAQuB,MACrBN,KAAO+B,KAAKhD,QAAQiB,KACpBN,IAAMrB,KAAKgC,OAAOnB,OAClB4E,gBAAkBzF,KAAK4C,SAASV,QAAO,CAACC,IAAKK,MAAQL,IAAMK,IAAI0B,YAAY,GACzD,MAApBuB,iBAA+C,KAApBA,gBAI1BpE,MAGLA,IAAIM,MAAQ3B,KAAK4C,wBAEXtD,SAAS,UAAWJ,UARtB0F,SAASC,gBAAkB,kBAAU,gBAAiB,yBAA2B,IAAMY,8CAexEC,yEACbhC,KAAOnE,SAASqC,cAAc,2BAC9BgD,SAAWlB,KAAK9B,cAAc,+BACpCgD,SAASC,UAAY,IAChBnB,kBAGCG,MAAQH,KAAK9B,cAAc,aAC7BiC,QACAA,MAAM8B,SAAWD,eAEf5B,MAAQJ,KAAK9B,cAAc,cAC7BkC,QACAA,MAAM6B,SAAWD,eAEfE,OAASlC,KAAK9B,cAAc,+BAC9BgE,SACAA,OAAOD,SAAWD,SAElBA,UACAd,SAASC,gBAAkB,kBAAU,iBAAkB"}