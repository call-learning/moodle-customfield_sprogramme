{"version":3,"file":"history.min.js","sources":["../src/history.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module history\n *\n * @module     customfield_sprogramme/history\n * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport State from 'customfield_sprogramme/local/state';\nimport Repository from 'customfield_sprogramme/local/repository';\nimport Notification from 'core/notification';\nimport './local/components/history';\n\n/**\n * Initialise the history module.\n */\nclass History {\n\n    /**\n     * Constructor.\n     * @param {Int} rfcid The rfcid.\n     * @param {Int} courseid The courseid.\n     * @return {void}\n     */\n    constructor(rfcid, courseid) {\n        this.rfcid = rfcid;\n        this.courseid = courseid;\n        this.getProgrammeHistory();\n    }\n\n    /**\n     * Get the stored programme history for this adminid.\n     */\n    async getProgrammeHistory() {\n        const context = {\n            rfcid: this.rfcid,\n            courseid: this.courseid,\n        };\n        try {\n            const response = await Repository.getProgrammeHistory(context);\n            if (response.length === 0) {\n                State.setValue('history', []);\n            }\n            const history = {\n                'modules': this.parseModules(response),\n                'columns': response.columns,\n                'rfcs': response.rfcs,\n            };\n            State.setValue('history', history);\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Parse the response, add the correct column properties to each cell.\n     * @param {Array} response The response.\n     * @return {Array} The parsed rows.\n     */\n    parseModules(response) {\n        response.modules.forEach(mod => {\n            mod.rows.map(row => {\n                row.cells = row.cells.map(cell => {\n                    const column = response.columns.find(column => column.column == cell.column);\n                    // Clone the column properties to the cell but keep the cell properties.\n                    cell = Object.assign({}, cell, column);\n                    if (cell.type === 'select') {\n                        // Clone the options array to avoid shared references\n                        cell.options = cell.options.map(option => {\n                            const clonedOption = Object.assign({}, option);\n                            if (clonedOption.name == cell.value) {\n                                clonedOption.selected = true;\n                            }\n                            return clonedOption;\n                        });\n                    }\n                    cell.edit = true;\n                    cell.changed = cell.value !== cell.oldvalue;\n                    return cell;\n                });\n                return row;\n            });\n        });\n        return response.modules;\n    }\n}\n\n/*\n * Initialise\n *\n * @param {Int} rfcid The rfcid.\n * @param {Int} courseid The courseid.\n */\nconst init = (rfcid, courseid) => {\n    new History(rfcid, courseid);\n};\n\nexport default {\n    init: init,\n};"],"names":["History","constructor","rfcid","courseid","getProgrammeHistory","context","this","response","Repository","length","setValue","history","parseModules","columns","rfcs","error","exception","modules","forEach","mod","rows","map","row","cells","cell","column","find","Object","assign","type","options","option","clonedOption","name","value","selected","edit","changed","oldvalue","init"],"mappings":";;;;;;;qOA+BMA,QAQFC,YAAYC,MAAOC,eACVD,MAAQA,WACRC,SAAWA,cACXC,wDAOCC,QAAU,CACZH,MAAOI,KAAKJ,MACZC,SAAUG,KAAKH,oBAGTI,eAAiBC,oBAAWJ,oBAAoBC,SAC9B,IAApBE,SAASE,uBACHC,SAAS,UAAW,UAExBC,QAAU,SACDL,KAAKM,aAAaL,kBAClBA,SAASM,aACZN,SAASO,qBAEfJ,SAAS,UAAWC,SAC5B,MAAOI,6BACQC,UAAUD,QAS/BH,aAAaL,iBACTA,SAASU,QAAQC,SAAQC,MACrBA,IAAIC,KAAKC,KAAIC,MACTA,IAAIC,MAAQD,IAAIC,MAAMF,KAAIG,aAChBC,OAASlB,SAASM,QAAQa,MAAKD,QAAUA,OAAOA,QAAUD,KAAKC,eAGnD,YADlBD,KAAOG,OAAOC,OAAO,GAAIJ,KAAMC,SACtBI,OAELL,KAAKM,QAAUN,KAAKM,QAAQT,KAAIU,eACtBC,aAAeL,OAAOC,OAAO,GAAIG,eACnCC,aAAaC,MAAQT,KAAKU,QAC1BF,aAAaG,UAAW,GAErBH,iBAGfR,KAAKY,MAAO,EACZZ,KAAKa,QAAUb,KAAKU,QAAUV,KAAKc,SAC5Bd,QAEJF,UAGRf,SAASU,sBAcT,CACXsB,KALS,CAACrC,MAAOC,gBACbH,QAAQE,MAAOC"}