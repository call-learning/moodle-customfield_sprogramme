{"version":3,"file":"programme_actions.min.js","sources":["../src/programme_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module formfield\n *\n * @module     customfield_sprogramme/formfield\n * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Manager from 'customfield_sprogramme/manager';\nimport History from 'customfield_sprogramme/history';\nimport {getString} from 'core/str';\nimport Modal from 'core/modal';\nimport $ from 'jquery';\n\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n */\nconst init = async() => {\n    document.addEventListener('click', async(event) => {\n        const editaction = event.target.closest('[data-action=\"editprogramme\"]');\n        if (editaction) {\n            const courseid = editaction.dataset.courseid;\n            await getEditor(editaction, courseid);\n            event.preventDefault();\n        }\n        const actionBtn = event.target.closest('[data-action=\"showrfc\"]');\n        if (actionBtn) {\n            const rfcid = parseInt(actionBtn.dataset.rfcid);\n            const courseid = actionBtn.dataset.courseid;\n            await showHistory(rfcid, courseid);\n            event.preventDefault();\n        }\n        const popOvers = document.querySelectorAll('[data-toggle=\"popover\"]');\n        const currentPopover = event.target.closest('[data-toggle=\"popover\"]');\n        if (popOvers.length > 0) {\n            popOvers.forEach((popover) => {\n                if (popover !== currentPopover) {\n                    $(popover).popover('hide');\n                }\n            });\n        }\n    });\n};\n\nconst showHistory = async(rfcid, courseid) => {\n    await getProgrammeHistory(rfcid, courseid);\n    const modalContent = document.querySelector('[data-region=\"history\"]');\n\n    const modal = await Modal.create({\n        large: true,\n        title: getString('history', 'customfield_sprogramme'),\n        body: modalContent,\n        show: true,\n    });\n    const modalElement = modal.getModal()[0];\n    modalElement.classList.add('modal-customfield_sprogramme_history');\n};\n\nclass CustomModal extends Modal {\n    constructor(root, canCloseCallback) {\n        super(root);\n        this.canCloseCallback = canCloseCallback;\n    }\n\n    hide() {\n        // Do not close the modal unless we do it explicitly.\n    }\n    close() {\n        super.hide();\n    }\n}\n\nconst getEditor = async(element, courseid) => {\n    await getProgramme(element, courseid);\n    const modalContent = document.querySelector('[data-region=\"app\"]');\n    const modalHeader = document.querySelector('[data-region=\"modalheader\"]');\n\n    const modal = await CustomModal.create({\n        large: true,\n        title: getString('editprogramme', 'customfield_sprogramme'),\n        body: modalContent,\n        show: true,\n    });\n\n    const modalElement = modal.getModal()[0];\n    modalElement.classList.add('modal-customfield_sprogramme_editor');\n    const header = modalElement.querySelector('[data-region=\"header\"]');\n    const title = modalElement.querySelector('[data-region=\"title\"]');\n    if (title) {\n        // Add the icone after the title Element.\n        header.insertBefore(modalHeader, title.nextSibling);\n    }\n\n    document.addEventListener('closeform', () => {\n        modal.close();\n        // Reload the page to show the changes.\n        window.location.reload();\n    });\n};\n\n/**\n * Get the programme.\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n * @return {Promise} The programme.\n */\nconst getProgramme = async(element, courseid) => {\n    Manager.init(element, courseid);\n};\n\n/**\n * Get the programme history.\n * @param {int} rfcid The Rfc id.\n * @param {int} courseid The course id.\n */\nconst getProgrammeHistory = async(rfcid, courseid) => {\n    History.init(rfcid, courseid);\n};\n\nexport default {\n    init: init,\n};"],"names":["showHistory","async","rfcid","courseid","getProgrammeHistory","modalContent","document","querySelector","Modal","create","large","title","body","show","getModal","classList","add","CustomModal","constructor","root","canCloseCallback","hide","close","getEditor","element","getProgramme","modalHeader","modal","modalElement","header","insertBefore","nextSibling","addEventListener","window","location","reload","init","editaction","event","target","closest","dataset","preventDefault","actionBtn","parseInt","popOvers","querySelectorAll","currentPopover","length","forEach","popover"],"mappings":";;;;;;;6PA4DMA,YAAcC,MAAMC,MAAOC,kBACvBC,oBAAoBF,MAAOC,gBAC3BE,aAAeC,SAASC,cAAc,kCAExBC,eAAMC,OAAO,CAC7BC,OAAO,EACPC,OAAO,kBAAU,UAAW,0BAC5BC,KAAMP,aACNQ,MAAM,KAEiBC,WAAW,GACzBC,UAAUC,IAAI,+CAGzBC,oBAAoBT,eACtBU,YAAYC,KAAMC,wBACRD,WACDC,iBAAmBA,iBAG5BC,QAGAC,cACUD,cAIRE,UAAYtB,MAAMuB,QAASrB,kBACvBsB,aAAaD,QAASrB,gBACtBE,aAAeC,SAASC,cAAc,uBACtCmB,YAAcpB,SAASC,cAAc,+BAErCoB,YAAcV,YAAYR,OAAO,CACnCC,OAAO,EACPC,OAAO,kBAAU,gBAAiB,0BAClCC,KAAMP,aACNQ,MAAM,IAGJe,aAAeD,MAAMb,WAAW,GACtCc,aAAab,UAAUC,IAAI,6CACrBa,OAASD,aAAarB,cAAc,0BACpCI,MAAQiB,aAAarB,cAAc,yBACrCI,OAEAkB,OAAOC,aAAaJ,YAAaf,MAAMoB,aAG3CzB,SAAS0B,iBAAiB,aAAa,KACnCL,MAAML,QAENW,OAAOC,SAASC,aAUlBV,aAAexB,MAAMuB,QAASrB,6BACxBiC,KAAKZ,QAASrB,WAQpBC,oBAAsBH,MAAMC,MAAOC,6BAC7BiC,KAAKlC,MAAOC,wBAGT,CACXiC,KAvGSnC,UACTK,SAAS0B,iBAAiB,SAAS/B,MAAAA,cACzBoC,WAAaC,MAAMC,OAAOC,QAAQ,oCACpCH,WAAY,OACNlC,SAAWkC,WAAWI,QAAQtC,eAC9BoB,UAAUc,WAAYlC,UAC5BmC,MAAMI,uBAEJC,UAAYL,MAAMC,OAAOC,QAAQ,8BACnCG,UAAW,OACLzC,MAAQ0C,SAASD,UAAUF,QAAQvC,OACnCC,SAAWwC,UAAUF,QAAQtC,eAC7BH,YAAYE,MAAOC,UACzBmC,MAAMI,uBAEJG,SAAWvC,SAASwC,iBAAiB,2BACrCC,eAAiBT,MAAMC,OAAOC,QAAQ,2BACxCK,SAASG,OAAS,GAClBH,SAASI,SAASC,UACVA,UAAYH,oCACVG,SAASA,QAAQ"}