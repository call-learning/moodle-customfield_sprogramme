{"version":3,"file":"programme_actions.min.js","sources":["../src/programme_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module formfield\n *\n * @module     customfield_sprogramme/formfield\n * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Manager from 'customfield_sprogramme/manager';\nimport History from 'customfield_sprogramme/history';\nimport {getString} from 'core/str';\nimport Modal from 'core/modal';\nimport $ from 'jquery';\n\n/**\n * The current programme manager instance.\n *\n * @type {Object|null}\n */\nlet currentProgrammeManager = null;\n\n/**\n * The current history manager instances indexed by id.\n * @type {Array}\n */\nlet currentHistoryManagers = [];\n\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} datafieldid The datafieldid.\n */\nconst init = async() => {\n    document.addEventListener('click', async(event) => {\n        const editaction = event.target.closest('[data-action=\"editprogramme\"]');\n        if (editaction) {\n            const datafieldid = editaction.dataset.datafieldid;\n            await getEditor(editaction, datafieldid);\n            event.preventDefault();\n        }\n        const actionBtn = event.target.closest('[data-action=\"showrfc\"]');\n        if (actionBtn) {\n            const rfcid = parseInt(actionBtn.dataset.rfcid);\n            const datafieldid = actionBtn.dataset.datafieldid;\n            await showHistory(rfcid, datafieldid);\n            event.preventDefault();\n        }\n        const popOvers = document.querySelectorAll('[data-toggle=\"popover\"]');\n        const currentPopover = event.target.closest('[data-toggle=\"popover\"]');\n        if (popOvers.length > 0) {\n            popOvers.forEach((popover) => {\n                if (popover !== currentPopover) {\n                    $(popover).popover('hide');\n                }\n            });\n        }\n    });\n};\n\n/**\n * Show the history modal.\n *\n * @param {Number} rfcid\n * @param {Number} datafieldid\n * @return {Promise<void>}\n */\nconst showHistory = async(rfcid, datafieldid) => {\n    await getProgrammeHistory(rfcid, datafieldid);\n    const modalContent = document.querySelector('[data-region=\"history\"]');\n\n    const modal = await Modal.create({\n        large: true,\n        title: getString('history', 'customfield_sprogramme'),\n        body: modalContent,\n        show: true,\n    });\n    const modalElement = modal.getModal()[0];\n    modalElement.classList.add('modal-customfield_sprogramme_history');\n};\n\nclass CustomModal extends Modal {\n    hide() {\n        // Do not close the modal unless we do it explicitly.\n    }\n    close() {\n        super.hide();\n    }\n}\n\n/**\n * Get the editor modal.\n * @param {HTMLElement} element\n * @param {Number} datafieldid\n * @return {Promise<void>}\n */\nconst getEditor = async(element, datafieldid) => {\n    await getProgramme(element, datafieldid);\n    const modalContent = document.querySelector('[data-region=\"app\"]');\n    const modalHeader = document.querySelector('[data-region=\"modalheader\"]');\n\n    const modal = await CustomModal.create({\n        large: true,\n        title: getString('editprogramme', 'customfield_sprogramme'),\n        body: modalContent,\n        show: true,\n    });\n\n    const modalElement = modal.getModal()[0];\n    modalElement.classList.add('modal-customfield_sprogramme_editor');\n    const header = modalElement.querySelector('[data-region=\"header\"]');\n    const title = modalElement.querySelector('[data-region=\"title\"]');\n    if (title) {\n        // Add the icone after the title Element.\n        header.insertBefore(modalHeader, title.nextSibling);\n    }\n\n    document.addEventListener('closeform', () => {\n        modal.close();\n    });\n};\n\n/**\n * Get the programme.\n * @param {HTMLElement} element The element.\n * @param {String} datafieldid The datafieldid.\n * @return {Promise} The programme.\n */\nconst getProgramme = async(element, datafieldid) => {\n    if (currentProgrammeManager) {\n        currentProgrammeManager.getTableData();\n    } else {\n        currentProgrammeManager = Manager.init(element, datafieldid);\n    }\n    return currentProgrammeManager;\n};\n\n/**\n * Get the programme history.\n * @param {Number} rfcid The Rfc id.\n * @param {Number} datafieldid The course id.\n */\nconst getProgrammeHistory = async(rfcid, datafieldid) => {\n    if (currentHistoryManagers[rfcid]) {\n        currentHistoryManagers[rfcid].getProgrammeHistory();\n    } else {\n        currentHistoryManagers[rfcid] = History.init(rfcid, datafieldid);\n    }\n    return currentHistoryManagers[rfcid];\n};\n\nexport default {\n    init: init,\n};\n"],"names":["currentProgrammeManager","currentHistoryManagers","showHistory","async","rfcid","datafieldid","getProgrammeHistory","modalContent","document","querySelector","Modal","create","large","title","body","show","getModal","classList","add","CustomModal","hide","close","getEditor","element","getProgramme","modalHeader","modal","modalElement","header","insertBefore","nextSibling","addEventListener","getTableData","Manager","init","History","editaction","event","target","closest","dataset","preventDefault","actionBtn","parseInt","popOvers","querySelectorAll","currentPopover","length","forEach","popover"],"mappings":";;;;;;;2PAiCIA,wBAA0B,KAM1BC,uBAAyB,SAyCvBC,YAAcC,MAAMC,MAAOC,qBACvBC,oBAAoBF,MAAOC,mBAC3BE,aAAeC,SAASC,cAAc,kCAExBC,eAAMC,OAAO,CAC7BC,OAAO,EACPC,OAAO,kBAAU,UAAW,0BAC5BC,KAAMP,aACNQ,MAAM,KAEiBC,WAAW,GACzBC,UAAUC,IAAI,+CAGzBC,oBAAoBT,eACtBU,QAGAC,cACUD,cAURE,UAAYnB,MAAMoB,QAASlB,qBACvBmB,aAAaD,QAASlB,mBACtBE,aAAeC,SAASC,cAAc,uBACtCgB,YAAcjB,SAASC,cAAc,+BAErCiB,YAAcP,YAAYR,OAAO,CACnCC,OAAO,EACPC,OAAO,kBAAU,gBAAiB,0BAClCC,KAAMP,aACNQ,MAAM,IAGJY,aAAeD,MAAMV,WAAW,GACtCW,aAAaV,UAAUC,IAAI,6CACrBU,OAASD,aAAalB,cAAc,0BACpCI,MAAQc,aAAalB,cAAc,yBACrCI,OAEAe,OAAOC,aAAaJ,YAAaZ,MAAMiB,aAG3CtB,SAASuB,iBAAiB,aAAa,KACnCL,MAAML,YAURG,aAAerB,MAAMoB,QAASlB,eAC5BL,wBACAA,wBAAwBgC,eAExBhC,wBAA0BiC,iBAAQC,KAAKX,QAASlB,aAE7CL,yBAQLM,oBAAsBH,MAAMC,MAAOC,eACjCJ,uBAAuBG,OACvBH,uBAAuBG,OAAOE,sBAE9BL,uBAAuBG,OAAS+B,iBAAQD,KAAK9B,MAAOC,aAEjDJ,uBAAuBG,qBAGnB,CACX8B,KAvHS/B,UACTK,SAASuB,iBAAiB,SAAS5B,MAAAA,cACzBiC,WAAaC,MAAMC,OAAOC,QAAQ,oCACpCH,WAAY,OACN/B,YAAc+B,WAAWI,QAAQnC,kBACjCiB,UAAUc,WAAY/B,aAC5BgC,MAAMI,uBAEJC,UAAYL,MAAMC,OAAOC,QAAQ,8BACnCG,UAAW,OACLtC,MAAQuC,SAASD,UAAUF,QAAQpC,OACnCC,YAAcqC,UAAUF,QAAQnC,kBAChCH,YAAYE,MAAOC,aACzBgC,MAAMI,uBAEJG,SAAWpC,SAASqC,iBAAiB,2BACrCC,eAAiBT,MAAMC,OAAOC,QAAQ,2BACxCK,SAASG,OAAS,GAClBH,SAASI,SAASC,UACVA,UAAYH,oCACVG,SAASA,QAAQ"}