{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module manager\n *\n * @module     customfield_sprogramme/manager\n * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport State from 'customfield_sprogramme/local/state';\nimport Repository from 'customfield_sprogramme/local/repository';\nimport Notification from 'core/notification';\nimport {debounce} from 'core/utils';\nimport './local/components/table';\nimport './tagmanager';\nimport './programme_form';\n\n/**\n * Manager class.\n * @class\n */\nclass Manager {\n\n    /**\n     * Row number.\n     */\n    rowNumber = 0;\n\n    /**\n     * Module number.\n     */\n    moduleNumber = 0;\n\n    /**\n     * The courseid.\n     * @type {Number}\n     */\n    courseid;\n\n    /**\n     * The element.\n     * @type {HTMLElement}\n     */\n    element;\n\n    /**\n     * The table name.\n     */\n    table = 'customfield_sprogramme';\n\n    /**\n     * The table columns.\n     * @type {Array}\n     */\n    columns = [];\n\n    /**\n     * Constructor.\n     * @param {HTMLElement} element The element.\n     * @param {String} courseid The courseid.\n     * @return {void}\n     */\n    constructor(element, courseid) {\n        this.element = element;\n        if (this.element.dataset.inintialized) {\n            return;\n        }\n        this.courseid = parseInt(courseid);\n        this.addEventListeners();\n        this.getTableData();\n        this.element.dataset.inintialized = true;\n    }\n\n    /**\n     * Add event listeners.\n     * @return {void}\n     */\n    addEventListeners() {\n        document.addEventListener('click', (e) => {\n            let btn = e.target.closest('.modal-customfield_sprogramme_editor [data-action]');\n            if (btn) {\n                e.preventDefault();\n                this.actions(btn);\n            }\n\n        });\n        // Listen to all changes in the table.\n        const form = document.querySelector('[data-region=\"app\"]');\n        form.addEventListener('change', (e) => {\n            const input = e.target.closest('[data-input=\"auto\"]');\n            if (input) {\n                this.change(input);\n            }\n            const modulename = e.target.closest('[data-region=\"modulename\"]');\n            if (modulename) {\n                this.changeModule(modulename);\n            }\n        });\n        // Resize the textareas when needed.\n        document.addEventListener('input', function(e) {\n            if (e.target.tagName === 'TEXTAREA') {\n                const textarea = e.target;\n                // Resize the textarea to fit the content.\n                textarea.style.height = 'auto'; // Reset height to auto to shrink if needed.\n                textarea.style.height = `${textarea.scrollHeight + 1}px`; // Set height to scrollHeight to fit content.\n                textarea.dataset.height = textarea.scrollHeight + 1; // Store the height in a data attribute.\n            }\n        });\n        // Listen to the arrow down and up keys to navigate to the next or previous row.\n        form.addEventListener('keydown', (e) => {\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                this.navigate(e);\n                e.preventDefault();\n            }\n        });\n        form.addEventListener('submit', (e) => {\n            e.preventDefault();\n        });\n\n        let dragging = null;\n        let isDraggingAllowed = false;\n        form.addEventListener('mousedown', (e) => {\n            if (e.target.closest('[data-region=\"dragicon\"]')) {\n                isDraggingAllowed = true;\n            } else {\n                isDraggingAllowed = false;\n            }\n        });\n        form.addEventListener('dragstart', (e) => {\n            if (!isDraggingAllowed) {\n                e.preventDefault();\n            }\n            if (e.target.tagName === 'TR') {\n                dragging = e.target;\n                e.target.effectAllowed = 'move';\n            }\n        });\n        form.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            const target = e.target.closest('tr');\n            if (target && target !== dragging && target.parentNode.dataset.region === 'rows') {\n                const rect = target.getBoundingClientRect();\n                if (e.clientY - rect.top > rect.height / 2) {\n                    target.parentNode.insertBefore(dragging, target.nextSibling);\n                } else {\n                    target.parentNode.insertBefore(dragging, target);\n                }\n            }\n        });\n        form.addEventListener(\"drop\", (e) => {\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        form.addEventListener('dragend', (e) => {\n            const rowId = dragging.dataset.index;\n            const prevRowId = dragging.previousElementSibling ? dragging.previousElementSibling.dataset.index : 0;\n            const moduleId = dragging.closest('[data-region=\"module\"]').dataset.id;\n            this.moveRow(parseInt(moduleId), parseInt(rowId), prevRowId ? parseInt(prevRowId) : null);\n            dragging = null;\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n    }\n\n    /**\n     * Get the table data.\n     * @return {void}\n     */\n    async getTableData() {\n        try {\n            const response = await Repository.getData({courseid: this.courseid, showrfc: 1});\n            if (response.modules.length > 0) {\n                const modules = this.parseModules(response);\n                const columns = response.columns;\n\n                State.setValue('columns', [...columns]);\n                State.setValue('modules', modules);\n                State.setValue('rfc', response.rfc);\n                State.setValue('editbuttons', {courseid: this.courseid, canedit: response.canedit});\n                this.sumtotals();\n            } else {\n                const response = await Repository.getColumns({courseid: this.courseid});\n                const columns = response.columns;\n                State.setValue('columns', [...columns]);\n                State.setValue('modules', []);\n                State.setValue('rfc', []);\n                State.setValue('editbuttons', {courseid: this.courseid, canedit: response.canedit});\n                this.addModule();\n            }\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Parse the response, add the correct column properties to each cell.\n     * @param {Array} response The response.\n     * @return {Array} The parsed rows.\n     */\n    parseModules(response) {\n        response.modules.forEach(mod => {\n            mod.editor = response.canedit;\n            mod.rows.map(row => {\n                row.cells = row.cells.map(cell => {\n                    const column = response.columns.find(column => column.column == cell.column);\n                    // Clone the column properties to the cell but keep the cell properties.\n                    cell = Object.assign({}, cell, column);\n                    if (cell.type === 'select') {\n                        // Clone the options array to avoid shared references\n                        cell.options = cell.options.map(option => {\n                            const clonedOption = Object.assign({}, option);\n                            if (clonedOption.name == cell.value) {\n                                clonedOption.selected = true;\n                            }\n                            return clonedOption;\n                        });\n                    }\n                    cell.changed = cell.value !== cell.oldvalue;\n                    return cell;\n                });\n                return row;\n            });\n        });\n        return response.modules;\n    }\n\n    /**\n     * Get the row object that can be accepted by the webservice.\n     * @return {Array} The keys.\n     */\n    getRowObject() {\n        return {\n            'rows': {\n                'id': 'id',\n                'sortorder': 'sortorder',\n                'deleted': 'false',\n                'todelete': 'false',\n                'cells': {\n                    'type': 'type',\n                    'column': 'column',\n                    'value': 'value',\n                    'group': 'group',\n                    'oldvalue': 'oldvalue',\n                },\n                'disciplines': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n                'competencies': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n            },\n        };\n    }\n\n    /**\n     * Check the cell value. It can not exceed the cell length.\n     * @param {object} cell The cell.\n     * @return {void}\n     */\n    checkCellValue(cell) {\n        if (cell.value === null) {\n            return;\n        }\n        if (cell.type === 'text' && cell.value.length > cell.length) {\n            cell.value = cell.value.substring(0, cell.length);\n        }\n    }\n\n    /**\n     * Clean a single cell.\n     * @param {object} cell The cell to clean.\n     * @param {Array} cellKeys The keys to keep in the cell.\n     */\n    cleanCell(cell, cellKeys) {\n        const cleaned = {};\n        this.checkCellValue(cell);\n        cellKeys.forEach(key => {\n            cleaned[key] = cell[key];\n        });\n        return cleaned;\n    }\n\n    /**\n     * Clean a list of objects based on allowed keys.\n     * @param {Array} items The items to clean.\n     * @param {Array} allowedKeys The keys to keep in the items.\n     */\n    cleanList(items, allowedKeys) {\n        return items.map(item => {\n            const cleaned = {};\n            allowedKeys.forEach(key => {\n                cleaned[key] = item[key];\n            });\n            return cleaned;\n        });\n    }\n\n    /**\n     * Validate the modules.\n     * @return {boolean} True if the modules are valid.\n     */\n    validateModules() {\n        const modules = State.getValue('modules');\n        let result = true;\n        if (modules.length === 0) {\n            result = false;\n            return result;\n        }\n        modules.forEach(module => {\n            if (!module.modulename || module.modulename.trim() === '') {\n                module.error = true;\n            }\n            module.rows.forEach(row => {\n                if (row.deleted) {\n                    return; // Skip deleted rows.\n                }\n                if (row.cells.length === 0) {\n                    row.error = true;\n                    result = false;\n                } else {\n                    if (!this.checkRow(row)) {\n                        result = false;\n                    }\n                }\n            });\n        });\n        State.setValue('modules', modules);\n        return result;\n    }\n\n    /**\n     * Check the row, if there are grouped cells, only one can have a value. and one should have a value.\n     * @param {Object} row The row to check.\n     * @return {boolean} True if the row is valid.\n     */\n    checkRow(row) {\n        const groups = {};\n        let result = true;\n        row.cells.forEach(cell => {\n            if (cell.group) {\n                if (!groups[cell.group]) {\n                    groups[cell.group] = [];\n                }\n                if (cell.value && cell.value > 0) {\n                    groups[cell.group].push(cell);\n                }\n            }\n        });\n        Object.keys(groups).forEach(group => {\n            if (groups[group].length > 1) {\n                // More than one cell in the group has a value.\n                groups[group].forEach(cell => {\n                    cell.error = true;\n                });\n                row.error = true;\n                result = false;\n            } else if (groups[group].length === 0) {\n                // No cell in the group has a value.\n                row.error = true;\n                result = false;\n            } else {\n                row.error = false;\n            }\n        });\n        return result;\n    }\n\n\n    /**\n     * Clean the Modules array.\n     * @param {Array} modules The modules.\n     * @return {Array} The cleaned modules.\n     */\n    cleanModules(modules) {\n        const rowSpec = this.getRowObject().rows;\n\n        return modules.map(module => {\n            const cleanedModule = {\n                moduleid: module.moduleid,\n                modulename: module.modulename,\n                modulesortorder: module.modulesortorder,\n                deleted: module.deleted || false,\n                rows: module.rows.map(row => {\n                    const cleanedRow = {\n                        id: row.id,\n                        sortorder: row.sortorder,\n                        deleted: row.deleted || false,\n                        cells: this.cleanList(row.cells, Object.keys(rowSpec.cells)),\n                        disciplines: this.cleanList(row.disciplines, Object.keys(rowSpec.disciplines)),\n                        competencies: this.cleanList(row.competencies, Object.keys(rowSpec.competencies)),\n                    };\n                    return cleanedRow;\n                }),\n            };\n            return cleanedModule;\n        });\n    }\n\n    /**\n     * Set the table data.\n     * @return {void}\n     */\n    async setTableData() {\n        const set = debounce(async() => {\n            const saveConfirmButton = document.querySelector('[data-action=\"saveconfirm\"]');\n            saveConfirmButton.classList.add('saving');\n            if (!this.validateModules()) {\n                return '';\n            }\n            const modules = State.getValue('modules');\n            const cleanedModules = this.cleanModules(modules);\n            const response = await Repository.setData({courseid: this.courseid, modules: cleanedModules});\n            if (!response) {\n                Notification.exception('No response from the server');\n            } else {\n                this.getTableData();\n                const update = await Repository.getData({courseid: this.courseid, showrfc: 0});\n                const modulesStatic = this.parseModules(update);\n                State.setValue('modulesstatic', modulesStatic);\n            }\n            setTimeout(() => {\n                saveConfirmButton.classList.remove('saving');\n            }, 200);\n        }, 600);\n        set();\n    }\n\n    /**\n     * Actions.\n     * @param {object} btn The button that was clicked.\n     */\n    actions(btn) {\n        const actionMap = {\n            'addrow': this.addRow,\n            'deleterow': this.deleteRow,\n            'addmodule': this.addModule,\n            'deletemodule': this.deleteModule,\n            'saveconfirm': this.setTableData,\n            'showchanges': this.showchanges,\n            'closechanges': this.closeChanges,\n            'acceptrfc': this.acceptRfc,\n            'rejectrfc': this.rejectRfc,\n            'submitrfc': this.submitRfc,\n            'cancelrfc': this.cancelRfc,\n            'removerfc': this.removeRfc,\n            'resetrfc': this.resetRfc,\n            'closeform': this.closeForm,\n            'downloadcsv': this.downloadCsv,\n            'augmenttable': this.augmentTable,\n        };\n        const action = btn.dataset.action;\n        if (actionMap[action]) {\n            actionMap[action].call(this, btn);\n        }\n    }\n\n    /**\n     * Inject a new row after this row.\n     * @param {object} btn The button that was clicked.\n     */\n    async addRow(btn) {\n        const modules = State.getValue('modules');\n\n        let rowid = btn.dataset.id;\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const module = modules.find(m => m.moduleid == moduleid);\n        const rows = module.rows;\n        // When called from the link under the table, the rowid is not set.\n        if (rowid == -1) {\n            rowid = rows[rows.length - 1].id;\n        }\n\n        const row = await this.createRow();\n        if (!row) {\n            return;\n        }\n        // Inject the row after the clicked row.\n        rows.splice(rows.indexOf(rows.find(r => r.id == rowid)) + 1, 0, row);\n        this.resetRowSortorder();\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Create a new row.\n     *\n     * @return {Object} The row object.\n     */\n     createRow() {\n        const row = {};\n        this.rowNumber = this.rowNumber - 1;\n        row.id = this.rowNumber;\n        const columns = State.getValue('columns');\n        // The copy the columns to the row and call them cells.\n        row.cells = columns.map(column => structuredClone(column));\n        // Set the correct types for the cells.\n        row.cells.forEach(cell => {\n            cell.edit = true;\n            cell.value = null;\n            cell[cell.type] = true;\n            cell.oldvalue = null;\n            cell.changed = false;\n        });\n        row.disciplines = [];\n        row.competencies = [];\n        return row;\n    }\n\n    /**\n     * Delete a row.\n     * @param {Object} btn The button that was clicked.\n     * @return {Promise} The promise.\n     */\n    async deleteRow(btn) {\n        const modules = State.getValue('modules');\n        const rowid = parseInt(btn.closest('[data-row]').dataset.index);\n        const moduleid = parseInt(btn.closest('[data-region=\"module\"]').dataset.id);\n        const modulefound = modules.find(m => m.moduleid == moduleid);\n        if (modulefound.rows.length > 0) {\n            // Find the row in the module.\n            const rowIndex = modulefound.rows.findIndex(r => r.id == rowid);\n            if (rowIndex !== -1) {\n                // Add the deleted attribute to the row.\n                if (rowid > 0) {\n                    modulefound.rows[rowIndex].deleted = true;\n                    // Set the changed attribute to each cell in the row.\n                    modulefound.rows[rowIndex].cells.forEach(cell => {\n                        if (cell.value !== null && (cell.type == 'float' || cell.type == 'number')) {\n                            cell.changed = true;\n                            cell.value = null; // Clear the value.\n                        }\n                    });\n                } else {\n                    // Remove the row from the module.\n                    modulefound.rows.splice(rowIndex, 1);\n                }\n                State.setValue('modules', modules);\n            } else {\n                Notification.exception('Row not found');\n            }\n        }\n        this.sumtotals();\n    }\n\n    /**\n     * Change.\n     * @param {object} input The input that was changed.\n     */\n    change(input) {\n        const row = input.closest('[data-row]');\n        const cell = input.closest('[data-cell]');\n        const group = input.dataset.group;\n        const value = input.value;\n        const columnid = parseInt(cell.dataset.columnid);\n        const index = parseInt(row.dataset.index);\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            // Find the correct cell in the row.\n            const rowIndex = module.rows.findIndex(r => r.id == index);\n            if (rowIndex === -1) {\n                return;\n            }\n            const cellIndex = module.rows[rowIndex].cells.findIndex(c => c.columnid == columnid);\n            const cell = module.rows[rowIndex].cells[cellIndex];\n            cell.value = value ? value : null;\n            if (input.dataset.height) {\n                cell.height = input.dataset.height;\n            }\n            // Find the other cells with the same group and null the value.\n            if (group) {\n                module.rows[rowIndex].cells.forEach(c => {\n                    if (c.group === group && c.columnid !== columnid && c.value !== null) {\n                        c.value = null;\n                    }\n                });\n            }\n            if (cell.type == 'select') {\n                // Find the option that matches the value and set it as selected.\n                cell.options.forEach(option => {\n                    option.selected = (option.name === value);\n                });\n            }\n        });\n        this.markchanges();\n        this.sumtotals();\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Markchanges.\n     * Mark the cells that have changed.\n     */\n    markchanges() {\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            module.rows.forEach(row => {\n                row.cells.forEach(cell => {\n                    cell.changed = cell.value != cell.oldvalue;\n                });\n            });\n        });\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Sumtotals.\n     * Sum all columns.\n     */\n    sumtotals() {\n        const columnsData = State.getValue('columns');\n        // Reset the sum for all columns.\n        columnsData.forEach(column => {\n            column.sum = 0;\n            column.changed = false;\n        });\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            module.rows.forEach(row => {\n                row.cells.forEach(cell => {\n                    if (cell.type === 'number' || cell.type === 'float') {\n                        const column = columnsData.find(c => c.columnid === cell.columnid);\n                        if (column) {\n                            if (cell.value) {\n                                column.sum = (parseFloat(column.sum) || 0) + parseFloat(cell.value);\n                            }\n                        }\n                        if (cell.changed) {\n                            column.changed = true;\n                        }\n                    }\n                });\n            });\n        });\n        State.setValue('columns', columnsData);\n    }\n\n    /**\n     * Change the module name.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    changeModule(input) {\n        const module = input.closest('[data-region=\"module\"]');\n        const moduleid = module.dataset.id;\n        const name = input.value;\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            if (module.moduleid == moduleid) {\n                module.modulename = name;\n            }\n        });\n    }\n\n    /**\n     * Delete a module.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async deleteModule(btn) {\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const modules = State.getValue('modules');\n        const moduleIndex = modules.findIndex(m => m.moduleid == moduleid);\n        if (moduleIndex !== -1) {\n            // Add the deleted attribute to the module.\n            modules[moduleIndex].deleted = true;\n            State.setValue('modules', modules);\n        }\n    }\n\n    /**\n     * Create a new module.\n     * @return {Integer} The module id.\n     */\n    createModule() {\n        this.moduleNumber = this.moduleNumber - 1;\n        return this.moduleNumber;\n    }\n\n    /**\n     * Add a new module.\n     * @return {void}\n     */\n    addModule() {\n        const modules = State.getValue('modules');\n        const moduleid = this.createModule();\n        const row = this.createRow();\n        const module = {\n            moduleid: moduleid,\n            modulename: ' ',\n            deleted: false,\n            editor: true,\n            rows: [row],\n        };\n        modules.push(module);\n        this.resetRowSortorder();\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Get the row from the state.\n     * @param {int} rowid The rowid.\n     */\n    getRow(rowid) {\n        const modules = State.getValue('modules');\n        // Combine all rows in one array.\n        const rows = modules.reduce((acc, module) => {\n            return acc.concat(module.rows);\n        }, []);\n        const row = rows.find(r => r.id == rowid);\n        return row;\n    }\n\n    /**\n     * Move a row within a module to a new position, based on previd.\n     * @param {Number} moduleId The module to update.\n     * @param {Number} rowId The row to move.\n     * @param {Number|null} prevRowId The row after which the moved row should appear. Null means move to top.\n     */\n    moveRow(moduleId, rowId, prevRowId) {\n        const modules = State.getValue('modules');\n        const module = modules.find(m => m.moduleid === moduleId);\n        if (!module) {\n            return;\n        }\n\n        const rows = module.rows;\n        const rowIndex = rows.findIndex(r => r.id === rowId);\n        if (rowIndex === -1) {\n            return;\n        }\n\n        // Remove the row from its current position\n        const [rowToMove] = rows.splice(rowIndex, 1);\n\n        // Find index to insert after\n        let insertIndex = 0;\n        if (prevRowId !== null) {\n            const prevIndex = rows.findIndex(r => r.id === prevRowId);\n            insertIndex = prevIndex + 1;\n        }\n\n        // Insert the row\n        rows.splice(insertIndex, 0, rowToMove);\n\n        // Reset sortorders\n        rows.forEach((row, index) => {\n            row.sortorder = index + 1;\n        });\n\n        // Update the state\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Reset the row sortorder values.\n     * @return {void}\n     */\n    resetRowSortorder() {\n        const modules = State.getValue('modules');\n        modules.forEach((module, mindex) => {\n            module.modulesortorder = mindex;\n            module.rows.forEach((row, index) => {\n                row.sortorder = index;\n            });\n        });\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Show the changes.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showchanges(btn) {\n        // Remove the active class from all buttons.\n        const tds = document.querySelectorAll('[data-action=\"showchanges\"]');\n        tds.forEach(td => {\n            if (td !== btn) {\n                td.classList.remove('active');\n            }\n        });\n        // Add the active class to the clicked button.\n        btn.classList.add('active');\n    }\n\n    /**\n     * Close the changes.\n     * @return {void}\n     */\n    async closeChanges() {\n        // Remove the active class from all buttons.\n        const tds = document.querySelectorAll('[data-action=\"showchanges\"]');\n        tds.forEach(td => {\n            td.classList.remove('active');\n        });\n    }\n\n    /**\n     * Accept the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async acceptRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.acceptRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n            const update = await Repository.getData({courseid: this.courseid, showrfc: 0});\n            const modulesStatic = this.parseModules(update);\n            State.setValue('modulesstatic', modulesStatic);\n        }\n    }\n\n    /**\n     * Reject the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async rejectRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.rejectRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Submit the RFC for approval.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async submitRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.submitRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Cancel the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async cancelRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.cancelRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Remove the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.removeRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Reset the table to the original state.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async resetRfc(btn) {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"rfc\"]');\n            if (input) {\n                input.dataset.input = 'auto';\n                input.value = input.dataset.oldvalue;\n                input.dataset.rfcstate = '0';\n                cell.classList.remove('rfc');\n            }\n        });\n        this.sumtotals();\n        btn.classList.add('d-none');\n    }\n\n    /**\n     * Augment the table with additional data.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async augmentTable(btn) {\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            module.rows.forEach(row => {\n                row.cells.forEach(cell => {\n                    if (cell.oldvalue != cell.value) {\n                        cell.changes = {\n                            oldvalue: cell.oldvalue ? cell.oldvalue : '0',\n                            newvalue: cell.value,\n                        };\n                        cell.changed = true;\n                    } else {\n                        cell.changes = null;\n                        cell.changed = false;\n                    }\n                });\n            });\n        });\n        State.setValue('modules', modules);\n        // Add the augment class to the button.\n        btn.classList.add('active');\n    }\n\n    /**\n     * Send a closeform custom event.\n     * @return {void}\n     */\n    closeForm() {\n        const event = new CustomEvent('closeform', {\n            bubbles: true,\n            composed: true,\n        });\n        document.dispatchEvent(event);\n    }\n\n    /**\n     * Download the table as a CSV file.\n     * @return {void}\n     */\n    async downloadCsv() {\n        const csv = await Repository.csvData({courseid: this.courseid});\n        const blob = new Blob([csv.csv], {type: 'text/csv'});\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = csv.filename;\n        a.click();\n        window.URL.revokeObjectURL(url);\n    }\n\n    /**\n     * Navigate to the next or previous row and left or right column.\n     * @param {Event} e The event.\n     * @return {void}\n     */\n    navigate(e) {\n        const currentIndex = e.target.closest('[data-row]').dataset.index;\n        const currentColumn = e.target.closest('[data-cell]').dataset.columnid;\n        const allRows = document.querySelectorAll('[data-row]');\n        for (let i = 0; i < allRows.length; i++) {\n            if (allRows[i].dataset.index == currentIndex) {\n                if (e.key === 'ArrowDown' && i < allRows.length - 1) {\n                    const nextInput = allRows[i + 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (nextInput) {\n                        nextInput.focus();\n                    }\n                }\n                if (e.key === 'ArrowUp' && i > 0) {\n                    const previousInput = allRows[i - 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (previousInput) {\n                        previousInput.focus();\n                    }\n                }\n            }\n        }\n        // This part is not working yet, it might not be accessible.\n        if (e.key === 'ArrowRight') {\n            const nextColumn = e.target.closest('[data-cell]').nextElementSibling;\n            if (nextColumn) {\n                nextColumn.focus();\n            }\n        }\n        if (e.key === 'ArrowLeft') {\n            const previousColumn = e.target.closest('[data-cell]').previousElementSibling;\n            if (previousColumn) {\n                previousColumn.focus();\n            }\n        }\n    }\n}\n\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n */\nconst init = (element, courseid) => {\n    new Manager(element, courseid);\n};\n\nexport default {\n    init: init,\n};"],"names":["Manager","constructor","element","courseid","this","dataset","inintialized","parseInt","addEventListeners","getTableData","document","addEventListener","e","btn","target","closest","preventDefault","actions","form","querySelector","input","change","modulename","changeModule","tagName","textarea","style","height","scrollHeight","key","navigate","dragging","isDraggingAllowed","effectAllowed","parentNode","region","rect","getBoundingClientRect","clientY","top","insertBefore","nextSibling","rowId","index","prevRowId","previousElementSibling","moduleId","id","moveRow","response","Repository","getData","showrfc","modules","length","parseModules","columns","setValue","rfc","canedit","sumtotals","getColumns","addModule","error","exception","forEach","mod","editor","rows","map","row","cells","cell","column","find","Object","assign","type","options","option","clonedOption","name","value","selected","changed","oldvalue","getRowObject","checkCellValue","substring","cleanCell","cellKeys","cleaned","cleanList","items","allowedKeys","item","validateModules","State","getValue","result","module","trim","deleted","checkRow","groups","group","push","keys","cleanModules","rowSpec","moduleid","modulesortorder","sortorder","disciplines","competencies","async","saveConfirmButton","classList","add","cleanedModules","setData","update","modulesStatic","setTimeout","remove","set","actionMap","addRow","deleteRow","deleteModule","setTableData","showchanges","closeChanges","acceptRfc","rejectRfc","submitRfc","cancelRfc","removeRfc","resetRfc","closeForm","downloadCsv","augmentTable","action","call","rowid","m","createRow","splice","indexOf","r","resetRowSortorder","rowNumber","structuredClone","edit","modulefound","rowIndex","findIndex","columnid","cellIndex","c","markchanges","columnsData","sum","parseFloat","moduleIndex","createModule","moduleNumber","getRow","reduce","acc","concat","rowToMove","insertIndex","mindex","querySelectorAll","td","userid","rfcstate","changes","newvalue","event","CustomEvent","bubbles","composed","dispatchEvent","csv","csvData","blob","Blob","url","window","URL","createObjectURL","a","createElement","href","download","filename","click","revokeObjectURL","currentIndex","currentColumn","allRows","i","nextInput","focus","previousInput","nextColumn","nextElementSibling","previousColumn","init"],"mappings":"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"}