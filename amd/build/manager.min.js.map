{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module manager\n *\n * @module     customfield_sprogramme/manager\n * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport State from 'customfield_sprogramme/local/state';\nimport Repository from 'customfield_sprogramme/local/repository';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {getString} from 'core/str';\nimport {debounce} from 'core/utils';\nimport './local/components/table';\n\n/**\n * Manager class.\n * @class\n */\nclass Manager {\n\n    /**\n     * Row number.\n     */\n    rowNumber = 0;\n\n    /**\n     * The courseid.\n     * @type {Number}\n     */\n    courseid;\n\n    /**\n     * The element.\n     * @type {HTMLElement}\n     */\n    element;\n\n    /**\n     * The table name.\n     */\n    table = 'customfield_sprogramme';\n\n    /**\n     * The table columns.\n     * @type {Array}\n     */\n    columns = [];\n\n    /**\n     * Constructor.\n     * @param {HTMLElement} element The element.\n     * @param {String} courseid The courseid.\n     * @return {void}\n     */\n    constructor(element, courseid) {\n        this.element = element;\n        if (this.element.dataset.inintialized) {\n            return;\n        }\n        this.courseid = parseInt(courseid);\n        this.addEventListeners();\n        this.getTableData();\n        this.element.dataset.inintialized = true;\n    }\n\n    /**\n     * Add event listeners.\n     * @return {void}\n     */\n    addEventListeners() {\n        const form = document.querySelector('[data-region=\"app\"]');\n        form.addEventListener('click', (e) => {\n            let btn = e.target.closest('[data-action]');\n            if (btn) {\n                e.preventDefault();\n                this.actions(btn);\n            } else {\n                const activetds = form.querySelectorAll('[data-action=\"showchanges\"]');\n                activetds.forEach(td => {\n                    td.classList.remove('active');\n                });\n            }\n            // Remove the useredits data attribute from all inputs in the form.\n            const inputs = form.querySelectorAll('[data-input=\"auto\"]');\n            inputs.forEach(input => {\n                input.dataset.useredits = 'false';\n            });\n            const input = e.target.closest('[data-input=\"auto\"]');\n            // Set the input dataattribute to editing\n            if (input) {\n                input.dataset.useredits = 'true';\n            }\n        });\n        // Listen to all changes in the table.\n        form.addEventListener('change', (e) => {\n            const input = e.target.closest('[data-input=\"auto\"]');\n            if (input) {\n                this.change(input);\n            }\n            const modulename = e.target.closest('[data-region=\"modulename\"]');\n            if (modulename) {\n                this.changeModule(modulename);\n            }\n        });\n        // Listen to the global saveprogrammconfirm event,\n        // if triggered save the data for the inputs that have useredits set to true.\n        document.addEventListener('saveprogrammconfirm', async() => {\n            const inputs = form.querySelectorAll('[data-input=\"auto\"]');\n            inputs.forEach(input => {\n                if (input.dataset.useredits === 'true') {\n                    this.change(input);\n                }\n            });\n            const response = await Repository.getData({courseid: this.courseid, showrfc: 0});\n            // Validate the response, the response.date should be a string that can be parsed to a JSON object.\n            if (response.modules.length > 0) {\n                const modules = this.parseModules(response.modules);\n                State.setValue('modulesstatic', modules);\n            }\n        });\n        // Listen to the arrow down and up keys to navigate to the next or previous row.\n        form.addEventListener('keydown', (e) => {\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                this.navigate(e);\n                e.preventDefault();\n            }\n            if (e.key === 'Enter') {\n                e.preventDefault();\n            }\n        });\n        form.addEventListener('submit', (e) => {\n            e.preventDefault();\n        });\n\n        let dragging = null;\n        let isDraggingAllowed = false;\n        form.addEventListener('mousedown', (e) => {\n            if (e.target.closest('[data-region=\"dragicon\"]')) {\n                isDraggingAllowed = true;\n            } else {\n                isDraggingAllowed = false;\n            }\n        });\n\n        form.addEventListener('dragstart', (e) => {\n            if (!isDraggingAllowed) {\n                e.preventDefault();\n            }\n            if (e.target.tagName === 'TR') {\n                dragging = e.target;\n                e.target.effectAllowed = 'move';\n            }\n        });\n        form.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            const target = e.target.closest('tr');\n            if (target && target !== dragging && target.parentNode.dataset.region === 'rows') {\n                const rect = target.getBoundingClientRect();\n                if (e.clientY - rect.top > rect.height / 2) {\n                    target.parentNode.insertBefore(dragging, target.nextSibling);\n                } else {\n                    target.parentNode.insertBefore(dragging, target);\n                }\n            }\n        });\n        form.addEventListener(\"drop\", (e) => {\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        form.addEventListener('dragend', (e) => {\n            const rowId = dragging.dataset.index;\n            const prevRowId = dragging.previousElementSibling ? dragging.previousElementSibling.dataset.index : 0;\n            const moduleId = dragging.closest('[data-region=\"module\"]').dataset.id;\n            Repository.updateSortOrder(\n                {\n                    type: 'row',\n                    courseid: this.courseid,\n                    moduleid: moduleId,\n                    id: rowId,\n                    previd: prevRowId\n                }\n            );\n            dragging = null;\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        // Disciplines form typeahead, using .disciplineform input[type=\"search\"]\n        // All options are already in the DOM, just show and hide them.\n        // On select return the discipline id and add it in this form to the cell\n        // {id: 1, value: 20}, {id: 2, value: 60}, {id: 7, value: 20}\n        // The value is set to 100 for now, this will be updated later in this code by adding another input field.\n        const disciplineForm = document.querySelector('[data-region=\"disciplineform\"]');\n        const search = disciplineForm.querySelector('input[type=\"search\"]');\n        search.addEventListener('input', (e) => {\n            const input = e.target.closest('input');\n            if (input) {\n                this.typeahead(input);\n            }\n        });\n\n        // Listen for the saveconfirm custom event. When run save the table data.\n        document.addEventListener('saveconfirm', () => {\n            this.setTableData();\n        });\n    }\n\n    /**\n     * Get the table configuration.\n     * @return {Promise} The promise.\n     */\n    async getTableConfig() {\n        const response = await Repository.getColumns({courseid: this.courseid});\n        await State.setValue('columns', response.columns);\n    }\n\n    /**\n     * Get the table data.\n     * @return {void}\n     */\n    async getTableData() {\n        try {\n            const response = await Repository.getData({courseid: this.courseid, showrfc: 1});\n            // Validate the response, the response.date should be a string that can be parsed to a JSON object.\n            if (response.modules.length > 0) {\n                const modules = this.parseModules(response.modules);\n                const columns = modules[0].columns;\n                // Now clone this columns array to the state.\n\n                State.setValue('columns', [...columns]);\n                State.setValue('modules', modules);\n                State.setValue('rfcs', response.rfcs);\n            } else {\n                const moduleid = await this.createModule('Module 1', 0);\n                await this.createRow(moduleid, 0, 0);\n                this.getTableData();\n            }\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Parse the modules, add the correct column properties to each cell.\n     * @param {Array} modules The modules.\n     * @return {Array} The parsed rows.\n     */\n    parseModules(modules) {\n        modules.forEach(mod => {\n            mod.rows.map(row => {\n                row.cells = row.cells.map(cell => {\n                    const column = mod.columns.find(column => column.column == cell.column);\n                    // Clone the column properties to the cell but keep the cell properties.\n                    cell = Object.assign({}, cell, column);\n                    if (cell.type === 'select') {\n                        // Clone the options array to avoid shared references\n                        cell.options = cell.options.map(option => {\n                            const clonedOption = Object.assign({}, option);\n                            if (clonedOption.name == cell.value) {\n                                clonedOption.selected = true;\n                            }\n                            return clonedOption;\n                        });\n                    }\n                    cell.edit = true;\n                    return cell;\n                });\n                return row;\n            });\n        });\n        return modules;\n    }\n\n    /**\n     * Get the row object that can be accepted by the webservice.\n     * @return {Array} The keys.\n     */\n    getRowObject() {\n        return {\n            'rows': {\n                'id': 'id',\n                'sortorder': 'sortorder',\n                'cells': {\n                    'type': 'type',\n                    'column': 'column',\n                    'value': 'value',\n                },\n                'disciplines': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n                'competencies': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n            },\n        };\n    }\n\n    /**\n     * Check the cell value. It can not exceed the cell length.\n     * @param {object} cell The cell.\n     * @return {void}\n     */\n    checkCellValue(cell) {\n        if (cell.value === null) {\n            return;\n        }\n        if (cell.type === 'text' && cell.value.length > cell.length) {\n            cell.value = cell.value.substring(0, cell.length);\n        }\n    }\n\n\n    /**\n     * Clean the Modules array.\n     * @param {Array} modules The modules.\n     * @return {Array} The cleaned modules.\n     */\n    cleanModules(modules) {\n        const cleanedModules = [];\n        modules.forEach(module => {\n            const rows = module.rows;\n            const rowObject = this.getRowObject();\n            const cleanedRows = rows.map(row => {\n                const cleanedRow = {};\n                Object.keys(rowObject.rows).forEach(key => {\n                    cleanedRow[key] = row[key];\n                });\n                // Clean the cells.\n                cleanedRow.cells = row.cells.map(cell => {\n                    const cleanedCell = {};\n                    this.checkCellValue(cell);\n                    Object.keys(rowObject.rows.cells).forEach(key => {\n                        cleanedCell[key] = cell[key];\n                    });\n                    return cleanedCell;\n                });\n                // Clean the disciplines.\n                cleanedRow.disciplines = row.disciplines.map(discipline => {\n                    const cleanedDiscipline = {};\n                    Object.keys(rowObject.rows.disciplines).forEach(key => {\n                        cleanedDiscipline[key] = discipline[key];\n                    });\n                    return cleanedDiscipline;\n                });\n                // Clean the competencies.\n                cleanedRow.competencies = row.competencies.map(competency => {\n                    const cleanedCompetency = {};\n                    Object.keys(rowObject.rows.competencies).forEach(key => {\n                        cleanedCompetency[key] = competency[key];\n                    });\n                    return cleanedCompetency;\n                });\n                return cleanedRow;\n            });\n            const cleanedModule = {};\n            cleanedModule.id = module.moduleid;\n            cleanedModule.sortorder = module.modulesortorder;\n            cleanedModule.name = module.modulename;\n            cleanedModule.rows = cleanedRows;\n            cleanedModules.push(cleanedModule);\n        });\n        return cleanedModules;\n    }\n\n    /**\n     * Set the table data.\n     * @return {void}\n     */\n    async setTableData() {\n        const set = debounce(async() => {\n            const saveConfirmButton = document.querySelector('[data-action=\"saveconfirm\"]');\n            const warnings = document.querySelector('[data-region=\"sprogramme-warnings\"]');\n            saveConfirmButton.classList.add('saving');\n            const modules = State.getValue('modules');\n            const cleanedModules = this.cleanModules(modules);\n            const response = await Repository.setData({courseid: this.courseid, modules: cleanedModules});\n            if (!response) {\n                Notification.exception('No response from the server');\n            } else {\n                if (response.data == 'newrfc') {\n                    this.getTableData();\n                }\n                if (response.data == 'rfclocked') {\n                    warnings.innerHTML = await getString('rfclocked', 'customfield_sprogramme');\n                    warnings.classList.remove('d-none');\n                    this.getTableData();\n                } else {\n                    warnings.innerHTML = '';\n                    warnings.classList.add('d-none');\n                }\n            }\n            setTimeout(() => {\n                saveConfirmButton.classList.remove('saving');\n            }, 200);\n        }, 600);\n        set();\n    }\n\n    /**\n     * Actions.\n     * @param {object} btn The button that was clicked.\n     */\n    actions(btn) {\n        const actionMap = {\n            'addrow': this.addRow,\n            'deleterow': this.deleteRow,\n            'addmodule': this.addModule,\n            'deletemodule': this.deleteModule,\n            'adddisc': this.showDisciplineForm,\n            'addcomp': this.showDisciplineForm,\n            'removedisc': this.removeDiscipline,\n            'closedisciplineform': this.closeDisciplineForm,\n            'selectdiscipline': (btn) => {\n                const option = btn.closest('[data-option]');\n                const discipline = {\n                    id: option.dataset.id,\n                    name: option.textContent,\n                };\n                this.setDisciplineForm(discipline);\n            },\n            'discipline-confirm': this.addDiscipline,\n            'saveconfirm': this.setTableData,\n            'loaddiscipline': this.loadDiscipline,\n            'showchanges': this.showchanges,\n            'acceptrfc': this.acceptRfc,\n            'rejectrfc': this.rejectRfc,\n            'submitrfc': this.submitRfc,\n            'cancelrfc': this.cancelRfc,\n            'removerfc': this.removeRfc,\n            'augmenttable': this.augmentTable,\n            'resetrfc': this.resetRfc,\n        };\n        const action = btn.dataset.action;\n        if (actionMap[action]) {\n            actionMap[action].call(this, btn);\n        }\n    }\n\n    /**\n     * Inject a new row after this row.\n     * @param {object} btn The button that was clicked.\n     */\n    async addRow(btn) {\n        const modules = State.getValue('modules');\n\n        let rowid = btn.dataset.id;\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const module = modules.find(m => m.moduleid == moduleid);\n        const rows = module.rows;\n        // When called from the link under the table, the rowid is not set.\n        if (rowid == -1) {\n            rowid = rows[rows.length - 1].id;\n        }\n\n        const row = await this.createRow(moduleid, rowid);\n        if (!row) {\n            return;\n        }\n        // Inject the row after the clicked row.\n        rows.splice(rows.indexOf(rows.find(r => r.id == rowid)) + 1, 0, row);\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Create a new row.\n     *\n     * @param {Number} moduleid The moduleid.\n     * @param {Number} prevrowid The previous rowid.\n     * @return {Promise} The promise.\n     */\n    async createRow(moduleid, prevrowid) {\n        const rowid = await Repository.createRow({courseid: this.courseid, moduleid: moduleid, prevrowid: prevrowid});\n        return new Promise((resolve) => {\n            const row = {};\n            row.id = rowid;\n            const columns = State.getValue('columns');\n            if (columns === undefined) {\n                resolve();\n                return;\n            }\n            // The copy the columns to the row and call them cells.\n            row.cells = columns.map(column => structuredClone(column));\n            // Set the correct types for the cells.\n            row.cells.forEach(cell => {\n                cell.edit = true;\n                cell.value = '';\n                cell[cell.type] = true;\n            });\n            row.disciplines = [];\n            row.competencies = [];\n            resolve(row);\n        });\n    }\n\n    /**\n     * Delete a row.\n     * @param {Object} btn The button that was clicked.\n     * @return {Promise} The promise.\n     */\n    async deleteRow(btn) {\n        const modules = State.getValue('modules');\n        const rowid = btn.closest('[data-row]').dataset.index;\n        const moduleid = parseInt(btn.closest('[data-region=\"module\"]').dataset.id);\n        const modulefound = modules.find(m => m.moduleid == moduleid);\n\n        let response = false;\n        if (modulefound.rows.length > 0) {\n            response = await Repository.deleteRow({courseid: this.courseid, rowid: rowid});\n        }\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Change.\n     * @param {object} input The input that was changed.\n     */\n    change(input) {\n        const row = input.closest('[data-row]');\n        const cell = input.closest('[data-cell]');\n        const group = input.dataset.group;\n        const value = input.value;\n        const columnid = parseInt(cell.dataset.columnid);\n        const index = parseInt(row.dataset.index);\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            // Find the correct cell in the row.\n            const rowIndex = module.rows.findIndex(r => r.id == index);\n            if (rowIndex === -1) {\n                return;\n            }\n            const cellIndex = module.rows[rowIndex].cells.findIndex(c => c.columnid == columnid);\n            module.rows[rowIndex].cells[cellIndex].value = value;\n            // Find the other cells with the same group and null the value.\n            if (group) {\n                module.rows[rowIndex].cells.forEach(c => {\n                    if (c.group === group && c.columnid !== columnid) {\n                        c.value = null;\n                        row.querySelector(`[data-columnid=\"${c.columnid}\"] input`).value = null;\n                    }\n                });\n            }\n        });\n        this.sumtotals();\n        this.setTableData();\n    }\n\n    /**\n     * Sumtotals.\n     * Sum all columns.\n     */\n    sumtotals() {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const columns = form.querySelectorAll('[data-region=\"sumtotals\"]');\n        columns.forEach(column => {\n            const columnid = column.dataset.columnid;\n            let sum = 0;\n            let containsRfc = false;\n            const inputs = form.querySelectorAll(`[data-columnid=\"${columnid}\"] input`);\n            inputs.forEach(input => {\n                if (input.value) {\n                    sum += parseFloat(input.value);\n                    if (input.dataset.rfcstate === '1') {\n                        containsRfc = true;\n                    }\n                }\n            });\n            sum = sum ? sum : '';\n            column.innerHTML = sum;\n            if (containsRfc) {\n                column.classList.add('rfc');\n                column.innerHTML = sum ? sum : 0;\n            }\n        });\n    }\n\n    /**\n     * Change the module name.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    changeModule(input) {\n        const module = input.closest('[data-region=\"module\"]');\n        const moduleid = module.dataset.id;\n        const name = input.value;\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            if (module.moduleid == moduleid) {\n                module.modulename = name;\n            }\n        });\n        this.setTableData();\n    }\n\n    /**\n     * Delete a module.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async deleteModule(btn) {\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const response = await Repository.deleteModule({courseid: this.courseid, moduleid: moduleid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Create a new module.\n     * @param {String} name The name.\n     * @param {Number} index The index.\n     * @return {Promise} The promise.\n     */\n    async createModule(name, index) {\n        const id = await Repository.createModule({name: name, courseid: this.courseid, sortorder: index});\n        return new Promise((resolve) => {\n            resolve(id);\n        });\n    }\n\n    /**\n     * Add a new module.\n     * @return {void}\n     */\n    async addModule() {\n        const modules = State.getValue('modules');\n        const moduleid = await this.createModule(' ', 0);\n        const row = await this.createRow(moduleid, 0);\n        const module = {\n            moduleid: moduleid,\n            modulename: ' ',\n            rows: [row],\n        };\n        modules.push(module);\n        this.resetRowSortorder();\n        State.setValue('modules', modules);\n        this.setTableData();\n    }\n\n    /**\n     * Get the row from the state.\n     * @param {int} rowid The rowid.\n     */\n    getRow(rowid) {\n        const modules = State.getValue('modules');\n        // Combine all rows in one array.\n        const rows = modules.reduce((acc, module) => {\n            return acc.concat(module.rows);\n        }, []);\n        const row = rows.find(r => r.id == rowid);\n        return row;\n    }\n\n    /**\n     * Reset the row sortorder values.\n     * @return {void}\n     */\n    resetRowSortorder() {\n        const modules = State.getValue('modules');\n        modules.forEach((module, mindex) => {\n            module.modulesortorder = mindex;\n            module.rows.forEach((row, index) => {\n                row.sortorder = index;\n            });\n        });\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Typeahead.\n     * Limit to 5 options.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    typeahead(input) {\n        const value = input.value;\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const options = form.querySelectorAll('[data-option]');\n        options.forEach(option => {\n            this.removeMatchBold(option);\n            if (option.textContent.toLowerCase().includes(value.toLowerCase())) {\n                option.classList.remove('d-none');\n                this.makeMatchBold(option, value);\n            } else {\n                option.classList.add('d-none');\n            }\n        });\n    }\n\n    /**\n     * Make the match bold.\n     * @param {object} option The option.\n     * @param {string} value The value.\n     * @return {void}\n     */\n    makeMatchBold(option, value) {\n        const text = option.textContent;\n        const index = text.toLowerCase().indexOf(value.toLowerCase());\n        const first = text.slice(0, index);\n        const match = text.slice(index, index + value.length);\n        const last = text.slice(index + value.length);\n        option.innerHTML = first + '<strong>' + match + '</strong>' + last;\n    }\n\n    /**\n     * Remove the match bold.\n     * @param {object} option The option.\n     * @return {void}\n     */\n    removeMatchBold(option) {\n        option.innerHTML = option.textContent;\n    }\n\n    /**\n     * Add a discipline to the row.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showDisciplineForm(btn) {\n        const btnAction = btn.dataset.action;\n        const region = btnAction === 'adddisc' ? 'data-disciplines' : 'data-competencies';\n        const row = btn.closest('[data-row]');\n        const module = btn.closest('[data-region=\"module\"]');\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        form.classList.remove('data-disciplines', 'data-competencies');\n        form.classList.add(region);\n        form.querySelector('#rowid').value = row.dataset.index;\n        const arrow = form.querySelector('.formarrow');\n        form.querySelector('#discipline-value').value = '';\n        form.querySelector('#discipline-name').value = '';\n\n        // Get the row index nr based on the row position in the table.\n        const rows = module.querySelectorAll('[data-region=\"rows\"] [data-row]');\n        const rowArray = Array.from(rows);\n        const index = rowArray.indexOf(row);\n        // Set the title of the form to show the row number.\n        form.querySelector('[data-region=\"rownumber\"]').textContent =\n            await getString('row', 'customfield_sprogramme', index + 1);\n        form.dataset.action = region;\n\n        // Attache the form to the first row for the first 8 rows.\n        // Then attach it to 8 rows before the clicked row.\n        // This makes sure the form is always visible.\n        const setindex = index - 8;\n        let attachTo;\n        let attachToButton;\n        if (setindex > 0) {\n            attachTo = rowArray[setindex].querySelector(`[${region}]`);\n            attachToButton = rowArray[setindex].querySelector(`[data-action=\"${btnAction}\"]`);\n        } else {\n            attachTo = rowArray[0].querySelector(`[${region}]`);\n            attachToButton = rowArray[0].querySelector(`[data-action=\"${btnAction}\"]`);\n        }\n        attachTo.appendChild(form);\n\n        // Position the form arrow next to the button that was clicked.\n        const rectBtn = btn.getBoundingClientRect();\n        const rectAttachToButton = attachToButton.getBoundingClientRect();\n        arrow.style.top = rectBtn.top - rectAttachToButton.top + 'px';\n        this.renderFormDisciplines(row.dataset.index, region);\n        this.disableFormInput(form);\n    }\n\n    /**\n     * Remove the discipline form.\n     * @return {void}\n     */\n    closeDisciplineForm() {\n        const container = document.querySelector('[data-region=\"disciplineform-container\"]');\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        container.appendChild(form);\n    }\n\n    /**\n     * Select a discipline.\n     * @param {object} discipline The discipline.\n     * @return {void}\n     */\n    async setDisciplineForm(discipline) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const formFieldSearch = form.querySelector('input[type=\"search\"]');\n        const formFieldValue = form.querySelector('#discipline-value');\n        const formFieldDiscipline = form.querySelector('#discipline-id');\n        const formFieldDisciplineName = form.querySelector('#discipline-name');\n        const formFieldLastIds = form.querySelector('#lastids');\n\n        formFieldDiscipline.value = discipline.id;\n        formFieldDisciplineName.value = discipline.name;\n        formFieldSearch.value = discipline.name;\n\n        // Add the discipline id to the formFieldLastIds.\n        const lastIds = formFieldLastIds.value.split(',');\n        if (!lastIds.includes(discipline.id)) {\n            lastIds.push(discipline.id);\n            formFieldLastIds.value = lastIds.join(',');\n        }\n        formFieldValue.focus();\n    }\n\n    /**\n     * Get the selected discipline.\n     * @param {object} form The form.\n     * @return {Promise} The promise.\n     */\n    async getSelectedDiscipline(form) {\n        const action = form.dataset.action;\n        const disciplineid = form.querySelector('#discipline-id').value;\n        const disciplinevalue = form.querySelector('#discipline-value').value;\n        const disciplinename = form.querySelector('#discipline-name').value;\n\n        if (!disciplineid || !disciplinevalue || !disciplinename) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = 'Invalid input';\n            return false;\n        }\n        const availableDisciplines = form.querySelectorAll(`[data-list=\"${action}\"] [data-action=\"selectdiscipline\"]`);\n        // Find the discipline in the available disciplines based on the discipline id.\n        const listedDiscipline = Array.from(availableDisciplines).find(d => d.dataset.id == disciplineid);\n        if (!listedDiscipline || listedDiscipline.textContent !== disciplinename) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('invalidinput', 'customfield_sprogramme');\n            return false;\n        }\n        const displine = {\n            id: disciplineid,\n            name: disciplinename,\n            percentage: parseInt(disciplinevalue),\n        };\n        // Return a promise.\n        return new Promise((resolve) => {\n            resolve(displine);\n        });\n    }\n\n    /**\n     * Load the discipline in the form.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    loadDiscipline(btn) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        form.querySelector('#discipline-id').value = btn.dataset.id;\n        form.querySelector('#discipline-name').value = btn.dataset.name;\n        form.querySelector('#discipline-value').value = btn.dataset.percentage;\n        form.querySelector('#discipline-value').focus();\n    }\n\n    /**\n     * Show the changes.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showchanges(btn) {\n        // Remove the active class from all buttons.\n        const tds = document.querySelectorAll('[data-action=\"showchanges\"]');\n        tds.forEach(td => {\n            if (td !== btn) {\n                td.classList.remove('active');\n            }\n        });\n        // Add the active class to the clicked button.\n        btn.classList.add('active');\n    }\n\n    /**\n     * Accept the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async acceptRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.acceptRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Reject the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async rejectRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.rejectRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Submit the RFC for approval.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async submitRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.submitRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Cancel the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async cancelRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.cancelRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Remove the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.removeRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Augment the table.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async augmentTable(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n\n        const form = document.querySelector('[data-region=\"app\"]');\n        const resetRfc = form.querySelector('[data-action=\"resetrfc\"]');\n        this.resetRfc(resetRfc);\n        resetRfc.classList.remove('d-none');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"auto\"]');\n            if (input) {\n                input.dataset.input = 'rfc';\n                const changesdiv = cell.querySelector('[data-changes][data-userid=\"' + userid + '\"]');\n                if (!changesdiv) {\n                    return;\n                }\n                const newvalue = changesdiv.dataset.newvalue;\n                input.dataset.oldvalue = input.value;\n                input.value = newvalue;\n                input.dataset.rfcstate = '1';\n                cell.classList.add('rfc');\n            }\n        });\n        this.sumtotals();\n    }\n\n    /**\n     * Reset the table to the original state.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async resetRfc(btn) {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"rfc\"]');\n            if (input) {\n                input.dataset.input = 'auto';\n                input.value = input.dataset.oldvalue;\n                input.dataset.rfcstate = '0';\n                cell.classList.remove('rfc');\n            }\n        });\n        this.sumtotals();\n        btn.classList.add('d-none');\n    }\n\n    /**\n     * Disable the form input if the maximum number of disciplines is reached.\n     * @param {object} form The form.\n     * @return {void}\n     */\n    async disableFormInput(form) {\n        const action = form.dataset.action;\n        const rowid = form.querySelector('#rowid').value;\n        const row = this.getRow(rowid);\n        if ((action === 'data-disciplines' && row.disciplines.length >= 3) ||\n            (action === 'data-competencies' && row.competencies.length >= 300)) {\n            form.querySelector('input[type=\"search\"]').disabled = true;\n            form.querySelector('input[type=\"number\"]').disabled = true;\n            form.querySelector('button[data-action=\"discipline-confirm\"]').disabled = true;\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('maxdisciplines', 'customfield_sprogramme', 3);\n        } else {\n            form.querySelector('input[type=\"search\"]').disabled = false;\n            form.querySelector('input[type=\"number\"]').disabled = false;\n            form.querySelector('button[data-action=\"discipline-confirm\"]').disabled = false;\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = '';\n        }\n    }\n\n    // Add a discipline to the row.\n    async addDiscipline() {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const action = form.dataset.action;\n        const discipline = await this.getSelectedDiscipline(form);\n        if (!discipline) {\n            return;\n        }\n        const rowid = form.querySelector('#rowid').value;\n        const row = this.getRow(rowid);\n        // Update or add the discipline to the row.\n        const containername = action === 'data-disciplines' ? 'container-disciplines' : 'container-competencies';\n        let disciplineIndex = 0;\n        let maxpercentage = 100;\n        if (action === 'data-disciplines') {\n            disciplineIndex = row.disciplines.findIndex(d => d.id == discipline.id);\n            maxpercentage = 100 - row.disciplines.reduce((acc, comp) => acc + parseInt(comp.percentage), 0);\n        }\n        if (action === 'data-competencies') {\n            disciplineIndex = row.competencies.findIndex(d => d.id == discipline.id);\n            maxpercentage = 100 - row.competencies.reduce((acc, disc) => acc + parseInt(disc.percentage), 0);\n        }\n        if (discipline.percentage > maxpercentage) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('maxpercentage', 'customfield_sprogramme', maxpercentage);\n            return;\n        } else {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = '';\n        }\n        const container = document.querySelector(\n            `[${action}][data-rowid=\"${rowid}\"] [data-region=\"${containername}\"]`);\n        const selectedcontainer = form.querySelector('[data-region=\"selected-disciplines\"]');\n        if (disciplineIndex > -1) {\n            if (action === 'data-disciplines') {\n                row.disciplines[disciplineIndex] = discipline;\n            }\n            if (action === 'data-competencies') {\n                row.competencies[disciplineIndex] = discipline;\n            }\n            const rendered = container.querySelector('[data-id=\"' + discipline.id + '\"]');\n            const selected = selectedcontainer.querySelector('[data-id=\"' + discipline.id + '\"]');\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            await Templates.replaceNode(rendered, html, js);\n            await Templates.replaceNode(selected, html, js);\n\n        } else {\n            if (action === 'data-disciplines') {\n                row.disciplines.push(discipline);\n            }\n            if (action === 'data-competencies') {\n                row.competencies.push(discipline);\n            }\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            await Templates.appendNodeContents(container, html, js);\n            await Templates.appendNodeContents(selectedcontainer, html, js);\n        }\n        this.disableFormInput(form);\n        this.setTableData();\n    }\n\n    /**\n     * Render the disciplines in the form.\n     * @param {int} rowid The rowid.\n     * @param {String} region The region.\n     * @return {void}\n     */\n    async renderFormDisciplines(rowid, region) {\n        const row = this.getRow(rowid);\n        let disciplines = [];\n        if (region === 'data-disciplines') {\n            disciplines = row.disciplines;\n        }\n        if (region === 'data-competencies') {\n            disciplines = row.competencies;\n        }\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const container = form.querySelector('[data-region=\"selected-disciplines\"]');\n        container.innerHTML = '';\n        disciplines.forEach(async(discipline) => {\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            Templates.appendNodeContents(container, html, js);\n        });\n    }\n\n    /**\n     * Remove a discipline from the row.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeDiscipline(btn) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const action = form.dataset.action;\n        const containername = action === 'data-disciplines' ? 'container-disciplines' : 'container-competencies';\n        const rowid = form.querySelector('#rowid').value;\n        const disciplineid = btn.closest('[data-id]').dataset.id;\n\n        // Remove the discipline from the row.\n        if (action === 'data-disciplines') {\n            const row = this.getRow(rowid);\n            const index = row.disciplines.findIndex(d => d.id == disciplineid);\n            row.disciplines.splice(index, 1);\n        }\n        if (action === 'data-competencies') {\n            const row = this.getRow(rowid);\n            const index = row.competencies.findIndex(d => d.id == disciplineid);\n            row.competencies.splice(index, 1);\n        }\n\n        // Remove the discipline/competency from the view.\n        const container = document.querySelector(\n            `[${action}][data-rowid=\"${rowid}\"] [data-region=\"${containername}\"]`);\n        const selectedcontainer = document.querySelector('[data-region=\"selected-disciplines\"]');\n        const discipline = container.querySelector('[data-id=\"' + disciplineid + '\"]');\n        const selected = selectedcontainer.querySelector('[data-id=\"' + disciplineid + '\"]');\n        container.removeChild(discipline);\n        selectedcontainer.removeChild(selected);\n        this.disableFormInput(form);\n        this.setTableData();\n    }\n\n    /**\n     * Navigate to the next or previous row and left or right column.\n     * @param {Event} e The event.\n     * @return {void}\n     */\n    navigate(e) {\n        const currentIndex = e.target.closest('[data-row]').dataset.index;\n        const currentColumn = e.target.closest('[data-cell]').dataset.columnid;\n        const allRows = document.querySelectorAll('[data-row]');\n        for (let i = 0; i < allRows.length; i++) {\n            if (allRows[i].dataset.index == currentIndex) {\n                if (e.key === 'ArrowDown' && i < allRows.length - 1) {\n                    const nextInput = allRows[i + 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (nextInput) {\n                        nextInput.focus();\n                    }\n                }\n                if (e.key === 'ArrowUp' && i > 0) {\n                    const previousInput = allRows[i - 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (previousInput) {\n                        previousInput.focus();\n                    }\n                }\n            }\n        }\n        // This part is not working yet, it might not be accessible.\n        if (e.key === 'ArrowRight') {\n            const nextColumn = e.target.closest('[data-cell]').nextElementSibling;\n            if (nextColumn) {\n                nextColumn.focus();\n            }\n        }\n        if (e.key === 'ArrowLeft') {\n            const previousColumn = e.target.closest('[data-cell]').previousElementSibling;\n            if (previousColumn) {\n                previousColumn.focus();\n            }\n        }\n    }\n}\n\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n */\nconst init = (element, courseid) => {\n    new Manager(element, courseid);\n};\n\nexport default {\n    init: init,\n};"],"names":["Manager","constructor","element","courseid","this","dataset","inintialized","parseInt","addEventListeners","getTableData","form","document","querySelector","addEventListener","e","btn","target","closest","preventDefault","actions","querySelectorAll","forEach","td","classList","remove","input","useredits","change","modulename","changeModule","async","response","Repository","getData","showrfc","modules","length","parseModules","setValue","key","navigate","dragging","isDraggingAllowed","tagName","effectAllowed","parentNode","region","rect","getBoundingClientRect","clientY","top","height","insertBefore","nextSibling","rowId","index","prevRowId","previousElementSibling","moduleId","id","updateSortOrder","type","moduleid","previd","typeahead","setTableData","getColumns","State","columns","rfcs","createModule","createRow","error","exception","mod","rows","map","row","cells","cell","column","find","Object","assign","options","option","clonedOption","name","value","selected","edit","getRowObject","checkCellValue","substring","cleanModules","cleanedModules","module","rowObject","cleanedRows","cleanedRow","keys","cleanedCell","disciplines","discipline","cleanedDiscipline","competencies","competency","cleanedCompetency","cleanedModule","sortorder","modulesortorder","push","saveConfirmButton","warnings","add","getValue","setData","data","innerHTML","setTimeout","set","actionMap","addRow","deleteRow","addModule","deleteModule","showDisciplineForm","removeDiscipline","closeDisciplineForm","textContent","setDisciplineForm","addDiscipline","loadDiscipline","showchanges","acceptRfc","rejectRfc","submitRfc","cancelRfc","removeRfc","augmentTable","resetRfc","action","call","rowid","m","splice","indexOf","r","prevrowid","Promise","resolve","undefined","structuredClone","group","columnid","rowIndex","findIndex","cellIndex","c","sumtotals","sum","containsRfc","parseFloat","rfcstate","resetRowSortorder","getRow","reduce","acc","concat","mindex","removeMatchBold","toLowerCase","includes","makeMatchBold","text","first","slice","match","last","btnAction","arrow","rowArray","Array","from","setindex","attachTo","attachToButton","appendChild","rectBtn","rectAttachToButton","style","renderFormDisciplines","disableFormInput","container","formFieldSearch","formFieldValue","formFieldDiscipline","formFieldDisciplineName","formFieldLastIds","lastIds","split","join","focus","disciplineid","disciplinevalue","disciplinename","availableDisciplines","listedDiscipline","d","displine","percentage","userid","changesdiv","newvalue","oldvalue","disabled","getSelectedDiscipline","containername","disciplineIndex","maxpercentage","comp","disc","selectedcontainer","rendered","html","js","Templates","renderForPromise","replaceNode","appendNodeContents","removeChild","currentIndex","currentColumn","allRows","i","nextInput","previousInput","nextColumn","nextElementSibling","previousColumn","init"],"mappings":"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"}