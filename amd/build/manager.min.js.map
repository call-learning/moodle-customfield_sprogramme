{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module manager\n *\n * @module     customfield_sprogramme/manager\n * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport State from 'customfield_sprogramme/local/state';\nimport Repository from 'customfield_sprogramme/local/repository';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {getString} from 'core/str';\nimport {debounce} from 'core/utils';\nimport './local/components/table';\n\n/**\n * Manager class.\n * @class\n */\nclass Manager {\n\n    /**\n     * Row number.\n     */\n    rowNumber = 0;\n\n    /**\n     * Module number.\n     */\n    moduleNumber = 0;\n\n    /**\n     * The courseid.\n     * @type {Number}\n     */\n    courseid;\n\n    /**\n     * The element.\n     * @type {HTMLElement}\n     */\n    element;\n\n    /**\n     * The table name.\n     */\n    table = 'customfield_sprogramme';\n\n    /**\n     * The table columns.\n     * @type {Array}\n     */\n    columns = [];\n\n    /**\n     * Constructor.\n     * @param {HTMLElement} element The element.\n     * @param {String} courseid The courseid.\n     * @return {void}\n     */\n    constructor(element, courseid) {\n        this.element = element;\n        if (this.element.dataset.inintialized) {\n            return;\n        }\n        this.courseid = parseInt(courseid);\n        this.addEventListeners();\n        this.getTableData();\n        this.element.dataset.inintialized = true;\n    }\n\n    /**\n     * Add event listeners.\n     * @return {void}\n     */\n    addEventListeners() {\n        const form = document.querySelector('[data-region=\"app\"]');\n        form.addEventListener('click', (e) => {\n            let btn = e.target.closest('[data-action]');\n            if (btn) {\n                e.preventDefault();\n                this.actions(btn);\n            } else {\n                const activetds = form.querySelectorAll('[data-action=\"showchanges\"]');\n                activetds.forEach(td => {\n                    td.classList.remove('active');\n                });\n            }\n        });\n        // Listen to all changes in the table.\n        form.addEventListener('change', (e) => {\n            const input = e.target.closest('[data-input=\"auto\"]');\n            if (input) {\n                this.change(input);\n            }\n            const modulename = e.target.closest('[data-region=\"modulename\"]');\n            if (modulename) {\n                this.changeModule(modulename);\n            }\n        });\n\n        // Listen to the arrow down and up keys to navigate to the next or previous row.\n        form.addEventListener('keydown', (e) => {\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                this.navigate(e);\n                e.preventDefault();\n            }\n            if (e.key === 'Enter') {\n                e.preventDefault();\n            }\n        });\n        form.addEventListener('submit', (e) => {\n            e.preventDefault();\n        });\n\n        let dragging = null;\n        let isDraggingAllowed = false;\n        form.addEventListener('mousedown', (e) => {\n            if (e.target.closest('[data-region=\"dragicon\"]')) {\n                isDraggingAllowed = true;\n            } else {\n                isDraggingAllowed = false;\n            }\n        });\n\n        form.addEventListener('dragstart', (e) => {\n            if (!isDraggingAllowed) {\n                e.preventDefault();\n            }\n            if (e.target.tagName === 'TR') {\n                dragging = e.target;\n                e.target.effectAllowed = 'move';\n            }\n        });\n        form.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            const target = e.target.closest('tr');\n            if (target && target !== dragging && target.parentNode.dataset.region === 'rows') {\n                const rect = target.getBoundingClientRect();\n                if (e.clientY - rect.top > rect.height / 2) {\n                    target.parentNode.insertBefore(dragging, target.nextSibling);\n                } else {\n                    target.parentNode.insertBefore(dragging, target);\n                }\n            }\n        });\n        form.addEventListener(\"drop\", (e) => {\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        form.addEventListener('dragend', (e) => {\n            const rowId = dragging.dataset.index;\n            const prevRowId = dragging.previousElementSibling ? dragging.previousElementSibling.dataset.index : 0;\n            const moduleId = dragging.closest('[data-region=\"module\"]').dataset.id;\n            this.moveRow(parseInt(moduleId), parseInt(rowId), prevRowId ? parseInt(prevRowId) : null);\n            dragging = null;\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        // Disciplines form typeahead, using .disciplineform input[type=\"search\"]\n        // All options are already in the DOM, just show and hide them.\n        // On select return the discipline id and add it in this form to the cell\n        // {id: 1, value: 20}, {id: 2, value: 60}, {id: 7, value: 20}\n        // The value is set to 100 for now, this will be updated later in this code by adding another input field.\n        const disciplineForm = document.querySelector('[data-region=\"disciplineform\"]');\n        const search = disciplineForm.querySelector('input[type=\"search\"]');\n        search.addEventListener('input', (e) => {\n            const input = e.target.closest('input');\n            if (input) {\n                this.typeahead(input);\n            }\n        });\n\n        // Listen for the saveconfirm custom event. When run save the table data.\n        document.addEventListener('saveconfirm', () => {\n            this.setTableData();\n        });\n    }\n\n    /**\n     * Get the table data.\n     * @return {void}\n     */\n    async getTableData() {\n        try {\n            const response = await Repository.getData({courseid: this.courseid, showrfc: 1});\n            // Validate the response, the response.date should be a string that can be parsed to a JSON object.\n            if (response.modules.length > 0) {\n                const modules = this.parseModules(response.modules);\n                const columns = modules[0].columns;\n                // Now clone this columns array to the state.\n\n                State.setValue('columns', [...columns]);\n                State.setValue('modules', modules);\n                State.setValue('rfcs', response.rfcs);\n            } else {\n                this.addModule();\n                this.getTableData();\n            }\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Parse the modules, add the correct column properties to each cell.\n     * @param {Array} modules The modules.\n     * @return {Array} The parsed rows.\n     */\n    parseModules(modules) {\n        modules.forEach(mod => {\n            mod.rows.map(row => {\n                row.cells = row.cells.map(cell => {\n                    const column = mod.columns.find(column => column.column == cell.column);\n                    // Clone the column properties to the cell but keep the cell properties.\n                    cell = Object.assign({}, cell, column);\n                    if (cell.type === 'select') {\n                        // Clone the options array to avoid shared references\n                        cell.options = cell.options.map(option => {\n                            const clonedOption = Object.assign({}, option);\n                            if (clonedOption.name == cell.value) {\n                                clonedOption.selected = true;\n                            }\n                            return clonedOption;\n                        });\n                    }\n                    cell.edit = true;\n                    return cell;\n                });\n                return row;\n            });\n        });\n        return modules;\n    }\n\n    /**\n     * Get the row object that can be accepted by the webservice.\n     * @return {Array} The keys.\n     */\n    getRowObject() {\n        return {\n            'rows': {\n                'id': 'id',\n                'sortorder': 'sortorder',\n                'deleted': 'false',\n                'cells': {\n                    'type': 'type',\n                    'column': 'column',\n                    'value': 'value',\n                },\n                'disciplines': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n                'competencies': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n            },\n        };\n    }\n\n    /**\n     * Check the cell value. It can not exceed the cell length.\n     * @param {object} cell The cell.\n     * @return {void}\n     */\n    checkCellValue(cell) {\n        if (cell.value === null) {\n            return;\n        }\n        if (cell.type === 'text' && cell.value.length > cell.length) {\n            cell.value = cell.value.substring(0, cell.length);\n        }\n    }\n\n    /**\n     * Clean a single cell.\n     * @param {object} cell The cell to clean.\n     * @param {Array} cellKeys The keys to keep in the cell.\n     */\n    cleanCell(cell, cellKeys) {\n        const cleaned = {};\n        this.checkCellValue(cell);\n        cellKeys.forEach(key => {\n            cleaned[key] = cell[key];\n        });\n        return cleaned;\n    }\n\n    /**\n     * Clean a list of objects based on allowed keys.\n     * @param {Array} items The items to clean.\n     * @param {Array} allowedKeys The keys to keep in the items.\n     */\n    cleanList(items, allowedKeys) {\n        return items.map(item => {\n            const cleaned = {};\n            allowedKeys.forEach(key => {\n                cleaned[key] = item[key];\n            });\n            return cleaned;\n        });\n    }\n\n    /**\n     * Clean the Modules array.\n     * @param {Array} modules The modules.\n     * @return {Array} The cleaned modules.\n     */\n    cleanModules(modules) {\n        const rowSpec = this.getRowObject().rows;\n\n        return modules.map(module => {\n            const cleanedModule = {\n                id: module.moduleid,\n                name: module.modulename,\n                sortorder: module.modulesortorder,\n                deleted: module.deleted || false,\n                rows: module.rows.map(row => {\n                    const cleanedRow = {\n                        id: row.id,\n                        sortorder: row.sortorder,\n                        deleted: row.deleted || false,\n                        cells: this.cleanList(row.cells, Object.keys(rowSpec.cells)),\n                        disciplines: this.cleanList(row.disciplines, Object.keys(rowSpec.disciplines)),\n                        competencies: this.cleanList(row.competencies, Object.keys(rowSpec.competencies)),\n                    };\n                    return cleanedRow;\n                }),\n            };\n            return cleanedModule;\n        });\n    }\n\n    /**\n     * Set the table data.\n     * @return {void}\n     */\n    async setTableData() {\n        const set = debounce(async() => {\n            const saveConfirmButton = document.querySelector('[data-action=\"saveconfirm\"]');\n            const warnings = document.querySelector('[data-region=\"sprogramme-warnings\"]');\n            saveConfirmButton.classList.add('saving');\n            const modules = State.getValue('modules');\n            const cleanedModules = this.cleanModules(modules);\n            const response = await Repository.setData({courseid: this.courseid, modules: cleanedModules});\n            if (!response) {\n                Notification.exception('No response from the server');\n            } else {\n                if (response.data == 'rfclocked') {\n                    warnings.innerHTML = await getString('rfclocked', 'customfield_sprogramme');\n                    warnings.classList.remove('d-none');\n                } else {\n                    warnings.innerHTML = '';\n                    warnings.classList.add('d-none');\n                }\n                this.getTableData();\n                const modulesStatic = State.getValue('modules');\n                State.setValue('modulesstatic', modulesStatic);\n            }\n            setTimeout(() => {\n                saveConfirmButton.classList.remove('saving');\n            }, 200);\n        }, 600);\n        set();\n    }\n\n    /**\n     * Actions.\n     * @param {object} btn The button that was clicked.\n     */\n    actions(btn) {\n        const actionMap = {\n            'addrow': this.addRow,\n            'deleterow': this.deleteRow,\n            'addmodule': this.addModule,\n            'deletemodule': this.deleteModule,\n            'adddisc': this.showDisciplineForm,\n            'addcomp': this.showDisciplineForm,\n            'removedisc': this.removeDiscipline,\n            'closedisciplineform': this.closeDisciplineForm,\n            'selectdiscipline': (btn) => {\n                const option = btn.closest('[data-option]');\n                const discipline = {\n                    id: option.dataset.id,\n                    name: option.textContent,\n                };\n                this.setDisciplineForm(discipline);\n            },\n            'discipline-confirm': this.addDiscipline,\n            'saveconfirm': this.setTableData,\n            'loaddiscipline': this.loadDiscipline,\n            'showchanges': this.showchanges,\n            'acceptrfc': this.acceptRfc,\n            'rejectrfc': this.rejectRfc,\n            'submitrfc': this.submitRfc,\n            'cancelrfc': this.cancelRfc,\n            'removerfc': this.removeRfc,\n            'augmenttable': this.augmentTable,\n            'resetrfc': this.resetRfc,\n        };\n        const action = btn.dataset.action;\n        if (actionMap[action]) {\n            actionMap[action].call(this, btn);\n        }\n    }\n\n    /**\n     * Inject a new row after this row.\n     * @param {object} btn The button that was clicked.\n     */\n    async addRow(btn) {\n        const modules = State.getValue('modules');\n\n        let rowid = btn.dataset.id;\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const module = modules.find(m => m.moduleid == moduleid);\n        const rows = module.rows;\n        // When called from the link under the table, the rowid is not set.\n        if (rowid == -1) {\n            rowid = rows[rows.length - 1].id;\n        }\n\n        const row = await this.createRow();\n        if (!row) {\n            return;\n        }\n        // Inject the row after the clicked row.\n        rows.splice(rows.indexOf(rows.find(r => r.id == rowid)) + 1, 0, row);\n        this.resetRowSortorder();\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Create a new row.\n     *\n     * @return {Object} The row object.\n     */\n     createRow() {\n\n        const row = {};\n        row.id = this.rowNumber - 1;\n        const columns = State.getValue('columns');\n        // The copy the columns to the row and call them cells.\n        row.cells = columns.map(column => structuredClone(column));\n        // Set the correct types for the cells.\n        row.cells.forEach(cell => {\n            cell.edit = true;\n            cell.value = '';\n            cell[cell.type] = true;\n        });\n        row.disciplines = [];\n        row.competencies = [];\n        return row;\n    }\n\n    /**\n     * Delete a row.\n     * @param {Object} btn The button that was clicked.\n     * @return {Promise} The promise.\n     */\n    async deleteRow(btn) {\n        const modules = State.getValue('modules');\n        const rowid = parseInt(btn.closest('[data-row]').dataset.index);\n        const moduleid = parseInt(btn.closest('[data-region=\"module\"]').dataset.id);\n        const modulefound = modules.find(m => m.moduleid == moduleid);\n        if (modulefound.rows.length > 0) {\n            // Find the row in the module.\n            const rowIndex = modulefound.rows.findIndex(r => r.id == rowid);\n            if (rowIndex !== -1) {\n                // Add the deleted attribute to the row.\n                modulefound.rows[rowIndex].deleted = true;\n                State.setValue('modules', modules);\n            } else {\n                Notification.exception('Row not found');\n            }\n        }\n    }\n\n    /**\n     * Change.\n     * @param {object} input The input that was changed.\n     */\n    change(input) {\n        const row = input.closest('[data-row]');\n        const cell = input.closest('[data-cell]');\n        const group = input.dataset.group;\n        const value = input.value;\n        const columnid = parseInt(cell.dataset.columnid);\n        const index = parseInt(row.dataset.index);\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            // Find the correct cell in the row.\n            const rowIndex = module.rows.findIndex(r => r.id == index);\n            if (rowIndex === -1) {\n                return;\n            }\n            const cellIndex = module.rows[rowIndex].cells.findIndex(c => c.columnid == columnid);\n            module.rows[rowIndex].cells[cellIndex].value = value;\n            // Find the other cells with the same group and null the value.\n            if (group) {\n                module.rows[rowIndex].cells.forEach(c => {\n                    if (c.group === group && c.columnid !== columnid) {\n                        c.value = null;\n                        row.querySelector(`[data-columnid=\"${c.columnid}\"] input`).value = null;\n                    }\n                });\n            }\n        });\n        this.sumtotals();\n        // this.setTableData();\n    }\n\n    /**\n     * Sumtotals.\n     * Sum all columns.\n     */\n    sumtotals() {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const columns = form.querySelectorAll('[data-region=\"sumtotals\"]');\n        columns.forEach(column => {\n            const columnid = column.dataset.columnid;\n            let sum = 0;\n            let containsRfc = false;\n            const inputs = form.querySelectorAll(`[data-columnid=\"${columnid}\"] input`);\n            inputs.forEach(input => {\n                if (input.value) {\n                    sum += parseFloat(input.value);\n                    if (input.dataset.rfcstate === '1') {\n                        containsRfc = true;\n                    }\n                }\n            });\n            sum = sum ? sum : '';\n            column.innerHTML = sum;\n            if (containsRfc) {\n                column.classList.add('rfc');\n                column.innerHTML = sum ? sum : 0;\n            }\n        });\n    }\n\n    /**\n     * Change the module name.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    changeModule(input) {\n        const module = input.closest('[data-region=\"module\"]');\n        const moduleid = module.dataset.id;\n        const name = input.value;\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            if (module.moduleid == moduleid) {\n                module.modulename = name;\n            }\n        });\n        // this.setTableData();\n    }\n\n    /**\n     * Delete a module.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async deleteModule(btn) {\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const modules = State.getValue('modules');\n        const moduleIndex = modules.findIndex(m => m.moduleid == moduleid);\n        if (moduleIndex !== -1) {\n            // Add the deleted attribute to the module.\n            modules[moduleIndex].deleted = true;\n            State.setValue('modules', modules);\n        }\n    }\n\n    /**\n     * Create a new module.\n     * @return {Integer} The module id.\n     */\n    async createModule() {\n        return this.moduleNumber--;\n    }\n\n    /**\n     * Add a new module.\n     * @return {void}\n     */\n    async addModule() {\n        const modules = State.getValue('modules');\n        const moduleid = await this.createModule();\n        const row = this.createRow();\n        const module = {\n            moduleid: moduleid,\n            modulename: ' ',\n            rows: [row],\n        };\n        modules.push(module);\n        this.resetRowSortorder();\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Get the row from the state.\n     * @param {int} rowid The rowid.\n     */\n    getRow(rowid) {\n        const modules = State.getValue('modules');\n        // Combine all rows in one array.\n        const rows = modules.reduce((acc, module) => {\n            return acc.concat(module.rows);\n        }, []);\n        const row = rows.find(r => r.id == rowid);\n        return row;\n    }\n\n    /**\n     * Move a row within a module to a new position, based on previd.\n     * @param {Number} moduleId The module to update.\n     * @param {Number} rowId The row to move.\n     * @param {Number|null} prevRowId The row after which the moved row should appear. Null means move to top.\n     */\n    moveRow(moduleId, rowId, prevRowId) {\n        const modules = State.getValue('modules');\n        const module = modules.find(m => m.moduleid === moduleId);\n        if (!module) {\n            return;\n        }\n\n        const rows = module.rows;\n        const rowIndex = rows.findIndex(r => r.id === rowId);\n        if (rowIndex === -1) {\n            return;\n        }\n\n        // Remove the row from its current position\n        const [rowToMove] = rows.splice(rowIndex, 1);\n\n        // Find index to insert after\n        let insertIndex = 0;\n        if (prevRowId !== null) {\n            const prevIndex = rows.findIndex(r => r.id === prevRowId);\n            insertIndex = prevIndex + 1;\n        }\n\n        // Insert the row\n        rows.splice(insertIndex, 0, rowToMove);\n\n        // Reset sortorders\n        rows.forEach((row, index) => {\n            row.sortorder = index + 1;\n        });\n\n        // Update the state\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Reset the row sortorder values.\n     * @return {void}\n     */\n    resetRowSortorder() {\n        const modules = State.getValue('modules');\n        modules.forEach((module, mindex) => {\n            module.modulesortorder = mindex;\n            module.rows.forEach((row, index) => {\n                row.sortorder = index;\n            });\n        });\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Typeahead.\n     * Limit to 5 options.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    typeahead(input) {\n        const value = input.value;\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const options = form.querySelectorAll('[data-option]');\n        options.forEach(option => {\n            this.removeMatchBold(option);\n            if (option.textContent.toLowerCase().includes(value.toLowerCase())) {\n                option.classList.remove('d-none');\n                this.makeMatchBold(option, value);\n            } else {\n                option.classList.add('d-none');\n            }\n        });\n    }\n\n    /**\n     * Make the match bold.\n     * @param {object} option The option.\n     * @param {string} value The value.\n     * @return {void}\n     */\n    makeMatchBold(option, value) {\n        const text = option.textContent;\n        const index = text.toLowerCase().indexOf(value.toLowerCase());\n        const first = text.slice(0, index);\n        const match = text.slice(index, index + value.length);\n        const last = text.slice(index + value.length);\n        option.innerHTML = first + '<strong>' + match + '</strong>' + last;\n    }\n\n    /**\n     * Remove the match bold.\n     * @param {object} option The option.\n     * @return {void}\n     */\n    removeMatchBold(option) {\n        option.innerHTML = option.textContent;\n    }\n\n    /**\n     * Add a discipline to the row.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showDisciplineForm(btn) {\n        const btnAction = btn.dataset.action;\n        const region = btnAction === 'adddisc' ? 'data-disciplines' : 'data-competencies';\n        const row = btn.closest('[data-row]');\n        const module = btn.closest('[data-region=\"module\"]');\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        form.classList.remove('data-disciplines', 'data-competencies');\n        form.classList.add(region);\n        form.querySelector('#rowid').value = row.dataset.index;\n        const arrow = form.querySelector('.formarrow');\n        form.querySelector('#discipline-value').value = '';\n        form.querySelector('#discipline-name').value = '';\n\n        // Get the row index nr based on the row position in the table.\n        const rows = module.querySelectorAll('[data-region=\"rows\"] [data-row]');\n        const rowArray = Array.from(rows);\n        const index = rowArray.indexOf(row);\n        // Set the title of the form to show the row number.\n        form.querySelector('[data-region=\"rownumber\"]').textContent =\n            await getString('row', 'customfield_sprogramme', index + 1);\n        form.dataset.action = region;\n\n        // Attache the form to the first row for the first 8 rows.\n        // Then attach it to 8 rows before the clicked row.\n        // This makes sure the form is always visible.\n        const setindex = index - 8;\n        let attachTo;\n        let attachToButton;\n        if (setindex > 0) {\n            attachTo = rowArray[setindex].querySelector(`[${region}]`);\n            attachToButton = rowArray[setindex].querySelector(`[data-action=\"${btnAction}\"]`);\n        } else {\n            attachTo = rowArray[0].querySelector(`[${region}]`);\n            attachToButton = rowArray[0].querySelector(`[data-action=\"${btnAction}\"]`);\n        }\n        attachTo.appendChild(form);\n\n        // Position the form arrow next to the button that was clicked.\n        const rectBtn = btn.getBoundingClientRect();\n        const rectAttachToButton = attachToButton.getBoundingClientRect();\n        arrow.style.top = rectBtn.top - rectAttachToButton.top + 'px';\n        this.renderFormDisciplines(row.dataset.index, region);\n        this.disableFormInput(form);\n    }\n\n    /**\n     * Remove the discipline form.\n     * @return {void}\n     */\n    closeDisciplineForm() {\n        const container = document.querySelector('[data-region=\"disciplineform-container\"]');\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        container.appendChild(form);\n    }\n\n    /**\n     * Select a discipline.\n     * @param {object} discipline The discipline.\n     * @return {void}\n     */\n    async setDisciplineForm(discipline) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const formFieldSearch = form.querySelector('input[type=\"search\"]');\n        const formFieldValue = form.querySelector('#discipline-value');\n        const formFieldDiscipline = form.querySelector('#discipline-id');\n        const formFieldDisciplineName = form.querySelector('#discipline-name');\n        const formFieldLastIds = form.querySelector('#lastids');\n\n        formFieldDiscipline.value = discipline.id;\n        formFieldDisciplineName.value = discipline.name;\n        formFieldSearch.value = discipline.name;\n\n        // Add the discipline id to the formFieldLastIds.\n        const lastIds = formFieldLastIds.value.split(',');\n        if (!lastIds.includes(discipline.id)) {\n            lastIds.push(discipline.id);\n            formFieldLastIds.value = lastIds.join(',');\n        }\n        formFieldValue.focus();\n    }\n\n    /**\n     * Get the selected discipline.\n     * @param {object} form The form.\n     * @return {Promise} The promise.\n     */\n    async getSelectedDiscipline(form) {\n        const action = form.dataset.action;\n        const disciplineid = form.querySelector('#discipline-id').value;\n        const disciplinevalue = form.querySelector('#discipline-value').value;\n        const disciplinename = form.querySelector('#discipline-name').value;\n\n        if (!disciplineid || !disciplinevalue || !disciplinename) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = 'Invalid input';\n            return false;\n        }\n        const availableDisciplines = form.querySelectorAll(`[data-list=\"${action}\"] [data-action=\"selectdiscipline\"]`);\n        // Find the discipline in the available disciplines based on the discipline id.\n        const listedDiscipline = Array.from(availableDisciplines).find(d => d.dataset.id == disciplineid);\n        if (!listedDiscipline || listedDiscipline.textContent !== disciplinename) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('invalidinput', 'customfield_sprogramme');\n            return false;\n        }\n        const displine = {\n            id: disciplineid,\n            name: disciplinename,\n            percentage: parseInt(disciplinevalue),\n        };\n        // Return a promise.\n        return new Promise((resolve) => {\n            resolve(displine);\n        });\n    }\n\n    /**\n     * Load the discipline in the form.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    loadDiscipline(btn) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        form.querySelector('#discipline-id').value = btn.dataset.id;\n        form.querySelector('#discipline-name').value = btn.dataset.name;\n        form.querySelector('#discipline-value').value = btn.dataset.percentage;\n        form.querySelector('#discipline-value').focus();\n    }\n\n    /**\n     * Show the changes.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showchanges(btn) {\n        // Remove the active class from all buttons.\n        const tds = document.querySelectorAll('[data-action=\"showchanges\"]');\n        tds.forEach(td => {\n            if (td !== btn) {\n                td.classList.remove('active');\n            }\n        });\n        // Add the active class to the clicked button.\n        btn.classList.add('active');\n    }\n\n    /**\n     * Accept the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async acceptRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.acceptRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Reject the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async rejectRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.rejectRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Submit the RFC for approval.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async submitRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.submitRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Cancel the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async cancelRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.cancelRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Remove the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.removeRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Augment the table.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async augmentTable(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n\n        const form = document.querySelector('[data-region=\"app\"]');\n        const resetRfc = form.querySelector('[data-action=\"resetrfc\"]');\n        this.resetRfc(resetRfc);\n        resetRfc.classList.remove('d-none');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"auto\"]');\n            if (input) {\n                input.dataset.input = 'rfc';\n                const changesdiv = cell.querySelector('[data-changes][data-userid=\"' + userid + '\"]');\n                if (!changesdiv) {\n                    return;\n                }\n                const newvalue = changesdiv.dataset.newvalue;\n                input.dataset.oldvalue = input.value;\n                input.value = newvalue;\n                input.dataset.rfcstate = '1';\n                cell.classList.add('rfc');\n            }\n        });\n        this.sumtotals();\n    }\n\n    /**\n     * Reset the table to the original state.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async resetRfc(btn) {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"rfc\"]');\n            if (input) {\n                input.dataset.input = 'auto';\n                input.value = input.dataset.oldvalue;\n                input.dataset.rfcstate = '0';\n                cell.classList.remove('rfc');\n            }\n        });\n        this.sumtotals();\n        btn.classList.add('d-none');\n    }\n\n    /**\n     * Disable the form input if the maximum number of disciplines is reached.\n     * @param {object} form The form.\n     * @return {void}\n     */\n    async disableFormInput(form) {\n        const action = form.dataset.action;\n        const rowid = form.querySelector('#rowid').value;\n        const row = this.getRow(rowid);\n        if ((action === 'data-disciplines' && row.disciplines.length >= 3) ||\n            (action === 'data-competencies' && row.competencies.length >= 300)) {\n            form.querySelector('input[type=\"search\"]').disabled = true;\n            form.querySelector('input[type=\"number\"]').disabled = true;\n            form.querySelector('button[data-action=\"discipline-confirm\"]').disabled = true;\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('maxdisciplines', 'customfield_sprogramme', 3);\n        } else {\n            form.querySelector('input[type=\"search\"]').disabled = false;\n            form.querySelector('input[type=\"number\"]').disabled = false;\n            form.querySelector('button[data-action=\"discipline-confirm\"]').disabled = false;\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = '';\n        }\n    }\n\n    // Add a discipline to the row.\n    async addDiscipline() {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const action = form.dataset.action;\n        const discipline = await this.getSelectedDiscipline(form);\n        if (!discipline) {\n            return;\n        }\n        const rowid = form.querySelector('#rowid').value;\n        const row = this.getRow(rowid);\n        // Update or add the discipline to the row.\n        const containername = action === 'data-disciplines' ? 'container-disciplines' : 'container-competencies';\n        let disciplineIndex = 0;\n        let maxpercentage = 100;\n        if (action === 'data-disciplines') {\n            disciplineIndex = row.disciplines.findIndex(d => d.id == discipline.id);\n            maxpercentage = 100 - row.disciplines.reduce((acc, comp) => acc + parseInt(comp.percentage), 0);\n        }\n        if (action === 'data-competencies') {\n            disciplineIndex = row.competencies.findIndex(d => d.id == discipline.id);\n            maxpercentage = 100 - row.competencies.reduce((acc, disc) => acc + parseInt(disc.percentage), 0);\n        }\n        if (discipline.percentage > maxpercentage) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('maxpercentage', 'customfield_sprogramme', maxpercentage);\n            return;\n        } else {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = '';\n        }\n        const container = document.querySelector(\n            `[${action}][data-rowid=\"${rowid}\"] [data-region=\"${containername}\"]`);\n        const selectedcontainer = form.querySelector('[data-region=\"selected-disciplines\"]');\n        if (disciplineIndex > -1) {\n            if (action === 'data-disciplines') {\n                row.disciplines[disciplineIndex] = discipline;\n            }\n            if (action === 'data-competencies') {\n                row.competencies[disciplineIndex] = discipline;\n            }\n            const rendered = container.querySelector('[data-id=\"' + discipline.id + '\"]');\n            const selected = selectedcontainer.querySelector('[data-id=\"' + discipline.id + '\"]');\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            await Templates.replaceNode(rendered, html, js);\n            await Templates.replaceNode(selected, html, js);\n\n        } else {\n            if (action === 'data-disciplines') {\n                row.disciplines.push(discipline);\n            }\n            if (action === 'data-competencies') {\n                row.competencies.push(discipline);\n            }\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            await Templates.appendNodeContents(container, html, js);\n            await Templates.appendNodeContents(selectedcontainer, html, js);\n        }\n        this.disableFormInput(form);\n    }\n\n    /**\n     * Render the disciplines in the form.\n     * @param {int} rowid The rowid.\n     * @param {String} region The region.\n     * @return {void}\n     */\n    async renderFormDisciplines(rowid, region) {\n        const row = this.getRow(rowid);\n        let disciplines = [];\n        if (region === 'data-disciplines') {\n            disciplines = row.disciplines;\n        }\n        if (region === 'data-competencies') {\n            disciplines = row.competencies;\n        }\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const container = form.querySelector('[data-region=\"selected-disciplines\"]');\n        container.innerHTML = '';\n        disciplines.forEach(async(discipline) => {\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            Templates.appendNodeContents(container, html, js);\n        });\n    }\n\n    /**\n     * Remove a discipline from the row.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeDiscipline(btn) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const action = form.dataset.action;\n        const containername = action === 'data-disciplines' ? 'container-disciplines' : 'container-competencies';\n        const rowid = form.querySelector('#rowid').value;\n        const disciplineid = btn.closest('[data-id]').dataset.id;\n\n        // Remove the discipline from the row.\n        if (action === 'data-disciplines') {\n            const row = this.getRow(rowid);\n            const index = row.disciplines.findIndex(d => d.id == disciplineid);\n            row.disciplines.splice(index, 1);\n        }\n        if (action === 'data-competencies') {\n            const row = this.getRow(rowid);\n            const index = row.competencies.findIndex(d => d.id == disciplineid);\n            row.competencies.splice(index, 1);\n        }\n\n        // Remove the discipline/competency from the view.\n        const container = document.querySelector(\n            `[${action}][data-rowid=\"${rowid}\"] [data-region=\"${containername}\"]`);\n        const selectedcontainer = document.querySelector('[data-region=\"selected-disciplines\"]');\n        const discipline = container.querySelector('[data-id=\"' + disciplineid + '\"]');\n        const selected = selectedcontainer.querySelector('[data-id=\"' + disciplineid + '\"]');\n        container.removeChild(discipline);\n        selectedcontainer.removeChild(selected);\n        this.disableFormInput(form);\n    }\n\n    /**\n     * Navigate to the next or previous row and left or right column.\n     * @param {Event} e The event.\n     * @return {void}\n     */\n    navigate(e) {\n        const currentIndex = e.target.closest('[data-row]').dataset.index;\n        const currentColumn = e.target.closest('[data-cell]').dataset.columnid;\n        const allRows = document.querySelectorAll('[data-row]');\n        for (let i = 0; i < allRows.length; i++) {\n            if (allRows[i].dataset.index == currentIndex) {\n                if (e.key === 'ArrowDown' && i < allRows.length - 1) {\n                    const nextInput = allRows[i + 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (nextInput) {\n                        nextInput.focus();\n                    }\n                }\n                if (e.key === 'ArrowUp' && i > 0) {\n                    const previousInput = allRows[i - 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (previousInput) {\n                        previousInput.focus();\n                    }\n                }\n            }\n        }\n        // This part is not working yet, it might not be accessible.\n        if (e.key === 'ArrowRight') {\n            const nextColumn = e.target.closest('[data-cell]').nextElementSibling;\n            if (nextColumn) {\n                nextColumn.focus();\n            }\n        }\n        if (e.key === 'ArrowLeft') {\n            const previousColumn = e.target.closest('[data-cell]').previousElementSibling;\n            if (previousColumn) {\n                previousColumn.focus();\n            }\n        }\n    }\n}\n\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n */\nconst init = (element, courseid) => {\n    new Manager(element, courseid);\n};\n\nexport default {\n    init: init,\n};"],"names":["Manager","constructor","element","courseid","this","dataset","inintialized","parseInt","addEventListeners","getTableData","form","document","querySelector","addEventListener","e","btn","target","closest","preventDefault","actions","querySelectorAll","forEach","td","classList","remove","input","change","modulename","changeModule","key","navigate","dragging","isDraggingAllowed","tagName","effectAllowed","parentNode","region","rect","getBoundingClientRect","clientY","top","height","insertBefore","nextSibling","rowId","index","prevRowId","previousElementSibling","moduleId","id","moveRow","typeahead","setTableData","response","Repository","getData","showrfc","modules","length","parseModules","columns","setValue","rfcs","addModule","error","exception","mod","rows","map","row","cells","cell","column","find","Object","assign","type","options","option","clonedOption","name","value","selected","edit","getRowObject","checkCellValue","substring","cleanCell","cellKeys","cleaned","cleanList","items","allowedKeys","item","cleanModules","rowSpec","module","moduleid","sortorder","modulesortorder","deleted","keys","disciplines","competencies","async","saveConfirmButton","warnings","add","State","getValue","cleanedModules","setData","data","innerHTML","modulesStatic","setTimeout","set","actionMap","addRow","deleteRow","deleteModule","showDisciplineForm","removeDiscipline","closeDisciplineForm","discipline","textContent","setDisciplineForm","addDiscipline","loadDiscipline","showchanges","acceptRfc","rejectRfc","submitRfc","cancelRfc","removeRfc","augmentTable","resetRfc","action","call","rowid","m","createRow","splice","indexOf","r","resetRowSortorder","rowNumber","structuredClone","modulefound","rowIndex","findIndex","group","columnid","cellIndex","c","sumtotals","sum","containsRfc","parseFloat","rfcstate","moduleIndex","moduleNumber","createModule","push","getRow","reduce","acc","concat","rowToMove","insertIndex","mindex","removeMatchBold","toLowerCase","includes","makeMatchBold","text","first","slice","match","last","btnAction","arrow","rowArray","Array","from","setindex","attachTo","attachToButton","appendChild","rectBtn","rectAttachToButton","style","renderFormDisciplines","disableFormInput","container","formFieldSearch","formFieldValue","formFieldDiscipline","formFieldDisciplineName","formFieldLastIds","lastIds","split","join","focus","disciplineid","disciplinevalue","disciplinename","availableDisciplines","listedDiscipline","d","displine","percentage","Promise","resolve","userid","changesdiv","newvalue","oldvalue","disabled","getSelectedDiscipline","containername","disciplineIndex","maxpercentage","comp","disc","selectedcontainer","rendered","html","js","Templates","renderForPromise","replaceNode","appendNodeContents","removeChild","currentIndex","currentColumn","allRows","i","nextInput","previousInput","nextColumn","nextElementSibling","previousColumn","init"],"mappings":"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"}