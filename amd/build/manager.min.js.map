{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module manager\n *\n * @module     customfield_sprogramme/manager\n * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport State from 'customfield_sprogramme/local/state';\nimport Repository from 'customfield_sprogramme/local/repository';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {getString} from 'core/str';\nimport {debounce} from 'core/utils';\nimport './local/components/table';\n\n/**\n * Manager class.\n * @class\n */\nclass Manager {\n\n    /**\n     * Row number.\n     */\n    rowNumber = 0;\n\n    /**\n     * The courseid.\n     * @type {Number}\n     */\n    courseid;\n\n    /**\n     * The element.\n     * @type {HTMLElement}\n     */\n    element;\n\n    /**\n     * The table name.\n     */\n    table = 'customfield_sprogramme';\n\n    /**\n     * The table columns.\n     * @type {Array}\n     */\n    columns = [];\n\n    /**\n     * Constructor.\n     * @param {HTMLElement} element The element.\n     * @param {String} courseid The courseid.\n     * @return {void}\n     */\n    constructor(element, courseid) {\n        this.element = element;\n        this.courseid = parseInt(courseid);\n        this.addEventListeners();\n        this.getDatagrid();\n    }\n\n    /**\n     * Add event listeners.\n     * @return {void}\n     */\n    addEventListeners() {\n        const form = document.querySelector('[data-region=\"app\"]');\n        form.addEventListener('click', (e) => {\n            let btn = e.target.closest('[data-action]');\n            if (btn) {\n                e.preventDefault();\n                this.actions(btn);\n            } else {\n                const activetds = form.querySelectorAll('[data-action=\"showchanges\"]');\n                activetds.forEach(td => {\n                    td.classList.remove('active');\n                });\n            }\n        });\n        // Listen to all changes in the table.\n        form.addEventListener('change', (e) => {\n            const input = e.target.closest('[data-input=\"auto\"]');\n            if (input) {\n                this.change(input);\n            }\n            const modulename = e.target.closest('[data-region=\"modulename\"]');\n            if (modulename) {\n                this.changeModule(modulename);\n            }\n        });\n        // Listen to the arrow down and up keys to navigate to the next or previous row.\n        form.addEventListener('keydown', (e) => {\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                this.navigate(e);\n                e.preventDefault();\n            }\n            if (e.key === 'Enter') {\n                e.preventDefault();\n            }\n        });\n        form.addEventListener('submit', (e) => {\n            e.preventDefault();\n        });\n\n        let dragging = null;\n        let isDraggingAllowed = false;\n        form.addEventListener('mousedown', (e) => {\n            if (e.target.closest('[data-region=\"dragicon\"]')) {\n                isDraggingAllowed = true;\n            } else {\n                isDraggingAllowed = false;\n            }\n        });\n\n        form.addEventListener('dragstart', (e) => {\n            if (!isDraggingAllowed) {\n                e.preventDefault();\n            }\n            if (e.target.tagName === 'TR') {\n                dragging = e.target;\n                e.target.effectAllowed = 'move';\n            }\n        });\n        form.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            const target = e.target.closest('tr');\n            if (target && target !== dragging && target.parentNode.dataset.region === 'rows') {\n                const rect = target.getBoundingClientRect();\n                if (e.clientY - rect.top > rect.height / 2) {\n                    target.parentNode.insertBefore(dragging, target.nextSibling);\n                } else {\n                    target.parentNode.insertBefore(dragging, target);\n                }\n            }\n        });\n        form.addEventListener(\"drop\", (e) => {\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        form.addEventListener('dragend', (e) => {\n            const rowId = dragging.dataset.index;\n            const prevRowId = dragging.previousElementSibling ? dragging.previousElementSibling.dataset.index : 0;\n            const moduleId = dragging.closest('[data-region=\"module\"]').dataset.id;\n            Repository.updateSortOrder(\n                {\n                    type: 'row',\n                    courseid: this.courseid,\n                    moduleid: moduleId,\n                    id: rowId,\n                    previd: prevRowId\n                }\n            );\n            dragging = null;\n            e.preventDefault(); // Voorkom standaard drop-actie\n        });\n        // Disciplines form typeahead, using .disciplineform input[type=\"search\"]\n        // All options are already in the DOM, just show and hide them.\n        // On select return the discipline id and add it in this form to the cell\n        // {id: 1, value: 20}, {id: 2, value: 60}, {id: 7, value: 20}\n        // The value is set to 100 for now, this will be updated later in this code by adding another input field.\n        const disciplineForm = document.querySelector('[data-region=\"disciplineform\"]');\n        const search = disciplineForm.querySelector('input[type=\"search\"]');\n        search.addEventListener('input', (e) => {\n            const input = e.target.closest('input');\n            if (input) {\n                this.typeahead(input);\n            }\n        });\n\n        // Listen for the saveconfirm custom event. When run save the table data.\n        document.addEventListener('saveconfirm', () => {\n            this.setTableData();\n        });\n    }\n\n    async getDatagrid() {\n        await this.getTableData();\n        await this.getTableConfig();\n    }\n\n    /**\n     * Get the table configuration.\n     * @return {Promise} The promise.\n     */\n    async getTableConfig() {\n        const response = await Repository.getColumns({courseid: this.courseid});\n        await State.setValue('columns', response.columns);\n    }\n\n    /**\n     * Get the table data.\n     * @return {void}\n     */\n    async getTableData() {\n        try {\n            const response = await Repository.getData({courseid: this.courseid, showrfc: 1});\n            // Validate the response, the response.date should be a string that can be parsed to a JSON object.\n            if (response.modules.length > 0) {\n                const modules = this.parseModules(response.modules);\n                State.setValue('modules', modules);\n                State.setValue('rfcs', response.rfcs);\n            } else {\n                const moduleid = await this.createModule('Module 1', 0);\n                await this.createRow(moduleid, 0, 0);\n                this.getTableData();\n            }\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Parse the modules, add the correct column properties to each cell.\n     * @param {Array} modules The modules.\n     * @return {Array} The parsed rows.\n     */\n    parseModules(modules) {\n        modules.forEach(mod => {\n            mod.rows.map(row => {\n                row.cells = row.cells.map(cell => {\n                    const column = mod.columns.find(column => column.column == cell.column);\n                    // Clone the column properties to the cell but keep the cell properties.\n                    cell = Object.assign({}, cell, column);\n                    if (cell.type === 'select') {\n                        // Clone the options array to avoid shared references\n                        cell.options = cell.options.map(option => {\n                            const clonedOption = Object.assign({}, option);\n                            if (clonedOption.name == cell.value) {\n                                clonedOption.selected = true;\n                            }\n                            return clonedOption;\n                        });\n                    }\n                    cell.edit = true;\n                    return cell;\n                });\n                return row;\n            });\n        });\n        return modules;\n    }\n\n    /**\n     * Get the row object that can be accepted by the webservice.\n     * @return {Array} The keys.\n     */\n    getRowObject() {\n        return {\n            'rows': {\n                'id': 'id',\n                'sortorder': 'sortorder',\n                'cells': {\n                    'type': 'type',\n                    'column': 'column',\n                    'value': 'value',\n                },\n                'disciplines': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n                'competencies': {\n                    'id': 'id',\n                    'name': 'name',\n                    'percentage': 'percentage',\n                },\n            },\n        };\n    }\n\n    /**\n     * Check the cell value. It can not exceed the cell length.\n     * @param {object} cell The cell.\n     * @return {void}\n     */\n    checkCellValue(cell) {\n        if (cell.value === null) {\n            return;\n        }\n        if (cell.type === 'text' && cell.value.length > cell.length) {\n            cell.value = cell.value.substring(0, cell.length);\n        }\n    }\n\n\n    /**\n     * Clean the Modules array.\n     * @param {Array} modules The modules.\n     * @return {Array} The cleaned modules.\n     */\n    cleanModules(modules) {\n        const cleanedModules = [];\n        modules.forEach(module => {\n            const rows = module.rows;\n            const rowObject = this.getRowObject();\n            const cleanedRows = rows.map(row => {\n                const cleanedRow = {};\n                Object.keys(rowObject.rows).forEach(key => {\n                    cleanedRow[key] = row[key];\n                });\n                // Clean the cells.\n                cleanedRow.cells = row.cells.map(cell => {\n                    const cleanedCell = {};\n                    this.checkCellValue(cell);\n                    Object.keys(rowObject.rows.cells).forEach(key => {\n                        cleanedCell[key] = cell[key];\n                    });\n                    return cleanedCell;\n                });\n                // Clean the disciplines.\n                cleanedRow.disciplines = row.disciplines.map(discipline => {\n                    const cleanedDiscipline = {};\n                    Object.keys(rowObject.rows.disciplines).forEach(key => {\n                        cleanedDiscipline[key] = discipline[key];\n                    });\n                    return cleanedDiscipline;\n                });\n                // Clean the competencies.\n                cleanedRow.competencies = row.competencies.map(competency => {\n                    const cleanedCompetency = {};\n                    Object.keys(rowObject.rows.competencies).forEach(key => {\n                        cleanedCompetency[key] = competency[key];\n                    });\n                    return cleanedCompetency;\n                });\n                return cleanedRow;\n            });\n            const cleanedModule = {};\n            cleanedModule.id = module.moduleid;\n            cleanedModule.sortorder = module.modulesortorder;\n            cleanedModule.name = module.modulename;\n            cleanedModule.rows = cleanedRows;\n            cleanedModules.push(cleanedModule);\n        });\n        return cleanedModules;\n    }\n\n    /**\n     * Set the table data.\n     * @return {void}\n     */\n    async setTableData() {\n        const set = debounce(async() => {\n            const saveConfirmButton = document.querySelector('[data-action=\"saveconfirm\"]');\n            const warnings = document.querySelector('[data-region=\"sprogramme-warnings\"]');\n            saveConfirmButton.classList.add('saving');\n            const modules = State.getValue('modules');\n            const cleanedModules = this.cleanModules(modules);\n            const response = await Repository.setData({courseid: this.courseid, modules: cleanedModules});\n            if (!response) {\n                Notification.exception('No response from the server');\n            } else {\n                window.console.log(response);\n                if (response.data == 'newrfc') {\n                    this.getTableData();\n                }\n                if (response.data == 'rfclocked') {\n                    warnings.innerHTML = await getString('rfclocked', 'customfield_sprogramme');\n                    warnings.classList.remove('d-none');\n                    this.getTableData();\n                } else {\n                    warnings.innerHTML = '';\n                    warnings.classList.add('d-none');\n                }\n            }\n            setTimeout(() => {\n                saveConfirmButton.classList.remove('saving');\n            }, 200);\n        }, 600);\n        set();\n    }\n\n    /**\n     * Actions.\n     * @param {object} btn The button that was clicked.\n     */\n    actions(btn) {\n        const actionMap = {\n            'addrow': this.addRow,\n            'deleterow': this.deleteRow,\n            'addmodule': this.addModule,\n            'deletemodule': this.deleteModule,\n            'adddisc': this.showDisciplineForm,\n            'addcomp': this.showDisciplineForm,\n            'removedisc': this.removeDiscipline,\n            'closedisciplineform': this.closeDisciplineForm,\n            'selectdiscipline': (btn) => {\n                const option = btn.closest('[data-option]');\n                const discipline = {\n                    id: option.dataset.id,\n                    name: option.textContent,\n                };\n                this.setDisciplineForm(discipline);\n            },\n            'discipline-confirm': this.addDiscipline,\n            'saveconfirm': this.setTableData,\n            'loaddiscipline': this.loadDiscipline,\n            'showchanges': this.showchanges,\n            'acceptrfc': this.acceptRfc,\n            'rejectrfc': this.rejectRfc,\n            'submitrfc': this.submitRfc,\n            'cancelrfc': this.cancelRfc,\n            'removerfc': this.removeRfc,\n            'augmenttable': this.augmentTable,\n            'resetrfc': this.resetRfc,\n        };\n        const action = btn.dataset.action;\n        if (actionMap[action]) {\n            actionMap[action].call(this, btn);\n        }\n    }\n\n    /**\n     * Inject a new row after this row.\n     * @param {object} btn The button that was clicked.\n     */\n    async addRow(btn) {\n        const modules = State.getValue('modules');\n\n        let rowid = btn.dataset.id;\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const module = modules.find(m => m.moduleid == moduleid);\n        const rows = module.rows;\n        // When called from the link under the table, the rowid is not set.\n        if (rowid == -1) {\n            rowid = rows[rows.length - 1].id;\n        }\n\n        const row = await this.createRow(moduleid, rowid);\n        if (!row) {\n            return;\n        }\n        // Inject the row after the clicked row.\n        rows.splice(rows.indexOf(rows.find(r => r.id == rowid)) + 1, 0, row);\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Create a new row.\n     *\n     * @param {Number} moduleid The moduleid.\n     * @param {Number} prevrowid The previous rowid.\n     * @return {Promise} The promise.\n     */\n    async createRow(moduleid, prevrowid) {\n        const rowid = await Repository.createRow({courseid: this.courseid, moduleid: moduleid, prevrowid: prevrowid});\n        return new Promise((resolve) => {\n            const row = {};\n            row.id = rowid;\n            const columns = State.getValue('columns');\n            if (columns === undefined) {\n                resolve();\n                return;\n            }\n            // The copy the columns to the row and call them cells.\n            row.cells = columns.map(column => structuredClone(column));\n            // Set the correct types for the cells.\n            row.cells.forEach(cell => {\n                cell.edit = true;\n                cell.value = '';\n                cell[cell.type] = true;\n            });\n            row.disciplines = [];\n            row.competencies = [];\n            resolve(row);\n        });\n    }\n\n    /**\n     * Delete a row.\n     * @param {Object} btn The button that was clicked.\n     * @return {Promise} The promise.\n     */\n    async deleteRow(btn) {\n        const modules = State.getValue('modules');\n        const rowid = btn.closest('[data-row]').dataset.index;\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const module = modules.find(m => m.moduleid == moduleid);\n        let response = false;\n        if (module.rows.length > 1) {\n            response = await Repository.deleteRow({courseid: this.courseid, rowid: rowid});\n        }\n        return new Promise((resolve) => {\n            if (response) {\n                const rows = module.rows;\n                const index = Array.from(btn.closest('[data-region=\"rows\"]').children).indexOf(btn.closest('[data-row]'));\n                rows.splice(index, 1);\n                this.resetRowSortorder();\n                State.setValue('modules', modules);\n            }\n            resolve(rowid);\n        });\n    }\n\n    /**\n     * Change.\n     * @param {object} input The input that was changed.\n     */\n    change(input) {\n        const row = input.closest('[data-row]');\n        const cell = input.closest('[data-cell]');\n        const group = input.dataset.group;\n        const value = input.value;\n        const columnid = parseInt(cell.dataset.columnid);\n        const index = parseInt(row.dataset.index);\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            // Find the correct cell in the row.\n            const rowIndex = module.rows.findIndex(r => r.id == index);\n            if (rowIndex === -1) {\n                return;\n            }\n            const cellIndex = module.rows[rowIndex].cells.findIndex(c => c.columnid == columnid);\n            module.rows[rowIndex].cells[cellIndex].value = value;\n            // Find the other cells with the same group and null the value.\n            if (group) {\n                module.rows[rowIndex].cells.forEach(c => {\n                    if (c.group === group && c.columnid !== columnid) {\n                        c.value = null;\n                        row.querySelector(`[data-columnid=\"${c.columnid}\"] input`).value = null;\n                    }\n                });\n            }\n        });\n        this.sumtotals();\n        this.setTableData();\n    }\n\n    /**\n     * Sumtotals.\n     * Sum all columns.\n     */\n    sumtotals() {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const columns = form.querySelectorAll('[data-region=\"sumtotals\"]');\n        columns.forEach(column => {\n            const columnid = column.dataset.columnid;\n            let sum = 0;\n            const inputs = form.querySelectorAll(`[data-columnid=\"${columnid}\"] input`);\n            inputs.forEach(input => {\n                if (input.value) {\n                    sum += parseFloat(input.value);\n                }\n            });\n            sum = sum ? sum : '';\n            column.innerHTML = sum;\n        });\n    }\n\n    /**\n     * Change the module name.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    changeModule(input) {\n        const module = input.closest('[data-region=\"module\"]');\n        const moduleid = module.dataset.id;\n        const name = input.value;\n        const modules = State.getValue('modules');\n        modules.forEach(module => {\n            if (module.moduleid == moduleid) {\n                module.modulename = name;\n            }\n        });\n        this.setTableData();\n    }\n\n    /**\n     * Delete a module.\n     * @param {object} btn The button that was clicked.\n     * @return {Promise} The promise.\n     * @return {void}\n     */\n    async deleteModule(btn) {\n        const modules = State.getValue('modules');\n        const moduleid = btn.closest('[data-region=\"module\"]').dataset.id;\n        const module = modules.find(m => m.moduleid == moduleid);\n        const response = await Repository.deleteModule({courseid: this.courseid, moduleid: moduleid});\n        return new Promise((resolve) => {\n            if (response) {\n                const index = modules.indexOf(module);\n                modules.splice(index, 1);\n                State.setValue('modules', modules);\n            }\n            resolve(moduleid);\n        });\n    }\n\n    /**\n     * Create a new module.\n     * @param {String} name The name.\n     * @param {Number} index The index.\n     * @return {Promise} The promise.\n     */\n    async createModule(name, index) {\n        const id = await Repository.createModule({name: name, courseid: this.courseid, sortorder: index});\n        return new Promise((resolve) => {\n            resolve(id);\n        });\n    }\n\n    /**\n     * Add a new module.\n     * @return {void}\n     */\n    async addModule() {\n        const modules = State.getValue('modules');\n        const moduleid = await this.createModule(' ', 0);\n        const row = await this.createRow(moduleid, 0);\n        const module = {\n            moduleid: moduleid,\n            modulename: ' ',\n            rows: [row],\n        };\n        modules.push(module);\n        this.resetRowSortorder();\n        State.setValue('modules', modules);\n        this.setTableData();\n    }\n\n    /**\n     * Get the row from the state.\n     * @param {int} rowid The rowid.\n     */\n    getRow(rowid) {\n        const modules = State.getValue('modules');\n        // Combine all rows in one array.\n        const rows = modules.reduce((acc, module) => {\n            return acc.concat(module.rows);\n        }, []);\n        const row = rows.find(r => r.id == rowid);\n        return row;\n    }\n\n    /**\n     * Reset the row sortorder values.\n     * @return {void}\n     */\n    resetRowSortorder() {\n        const modules = State.getValue('modules');\n        modules.forEach((module, mindex) => {\n            module.modulesortorder = mindex;\n            module.rows.forEach((row, index) => {\n                row.sortorder = index;\n            });\n        });\n        State.setValue('modules', modules);\n    }\n\n    /**\n     * Typeahead.\n     * Limit to 5 options.\n     * @param {object} input The input that was changed.\n     * @return {void}\n     */\n    typeahead(input) {\n        const value = input.value;\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const options = form.querySelectorAll('[data-option]');\n        options.forEach(option => {\n            this.removeMatchBold(option);\n            if (option.textContent.toLowerCase().includes(value.toLowerCase())) {\n                option.classList.remove('d-none');\n                this.makeMatchBold(option, value);\n            } else {\n                option.classList.add('d-none');\n            }\n        });\n    }\n\n    /**\n     * Make the match bold.\n     * @param {object} option The option.\n     * @param {string} value The value.\n     * @return {void}\n     */\n    makeMatchBold(option, value) {\n        const text = option.textContent;\n        const index = text.toLowerCase().indexOf(value.toLowerCase());\n        const first = text.slice(0, index);\n        const match = text.slice(index, index + value.length);\n        const last = text.slice(index + value.length);\n        option.innerHTML = first + '<strong>' + match + '</strong>' + last;\n    }\n\n    /**\n     * Remove the match bold.\n     * @param {object} option The option.\n     * @return {void}\n     */\n    removeMatchBold(option) {\n        option.innerHTML = option.textContent;\n    }\n\n    /**\n     * Add a discipline to the row.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showDisciplineForm(btn) {\n        const btnAction = btn.dataset.action;\n        const region = btnAction === 'adddisc' ? 'data-disciplines' : 'data-competencies';\n        const row = btn.closest('[data-row]');\n        const module = btn.closest('[data-region=\"module\"]');\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        form.classList.remove('data-disciplines', 'data-competencies');\n        form.classList.add(region);\n        form.querySelector('#rowid').value = row.dataset.index;\n        const arrow = form.querySelector('.formarrow');\n        form.querySelector('#discipline-value').value = '';\n        form.querySelector('#discipline-name').value = '';\n\n        // Get the row index nr based on the row position in the table.\n        const rows = module.querySelectorAll('[data-region=\"rows\"] [data-row]');\n        const rowArray = Array.from(rows);\n        const index = rowArray.indexOf(row);\n        // Set the title of the form to show the row number.\n        form.querySelector('[data-region=\"rownumber\"]').textContent =\n            await getString('row', 'customfield_sprogramme', index + 1);\n        form.dataset.action = region;\n\n        // Attache the form to the first row for the first 8 rows.\n        // Then attach it to 8 rows before the clicked row.\n        // This makes sure the form is always visible.\n        const setindex = index - 8;\n        let attachTo;\n        let attachToButton;\n        if (setindex > 0) {\n            attachTo = rowArray[setindex].querySelector(`[${region}]`);\n            attachToButton = rowArray[setindex].querySelector(`[data-action=\"${btnAction}\"]`);\n        } else {\n            attachTo = rowArray[0].querySelector(`[${region}]`);\n            attachToButton = rowArray[0].querySelector(`[data-action=\"${btnAction}\"]`);\n        }\n        attachTo.appendChild(form);\n\n        // Position the form arrow next to the button that was clicked.\n        const rectBtn = btn.getBoundingClientRect();\n        const rectAttachToButton = attachToButton.getBoundingClientRect();\n        arrow.style.top = rectBtn.top - rectAttachToButton.top + 'px';\n        this.renderFormDisciplines(row.dataset.index, region);\n        this.disableFormInput(form);\n    }\n\n    /**\n     * Remove the discipline form.\n     * @return {void}\n     */\n    closeDisciplineForm() {\n        const container = document.querySelector('[data-region=\"disciplineform-container\"]');\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        container.appendChild(form);\n    }\n\n    /**\n     * Select a discipline.\n     * @param {object} discipline The discipline.\n     * @return {void}\n     */\n    async setDisciplineForm(discipline) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const formFieldSearch = form.querySelector('input[type=\"search\"]');\n        const formFieldValue = form.querySelector('#discipline-value');\n        const formFieldDiscipline = form.querySelector('#discipline-id');\n        const formFieldDisciplineName = form.querySelector('#discipline-name');\n        const formFieldLastIds = form.querySelector('#lastids');\n\n        formFieldDiscipline.value = discipline.id;\n        formFieldDisciplineName.value = discipline.name;\n        formFieldSearch.value = discipline.name;\n\n        // Add the discipline id to the formFieldLastIds.\n        const lastIds = formFieldLastIds.value.split(',');\n        if (!lastIds.includes(discipline.id)) {\n            lastIds.push(discipline.id);\n            formFieldLastIds.value = lastIds.join(',');\n        }\n        formFieldValue.focus();\n    }\n\n    /**\n     * Get the selected discipline.\n     * @param {object} form The form.\n     * @return {Promise} The promise.\n     */\n    async getSelectedDiscipline(form) {\n        const action = form.dataset.action;\n        const disciplineid = form.querySelector('#discipline-id').value;\n        const disciplinevalue = form.querySelector('#discipline-value').value;\n        const disciplinename = form.querySelector('#discipline-name').value;\n\n        if (!disciplineid || !disciplinevalue || !disciplinename) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = 'Invalid input';\n            return false;\n        }\n        const availableDisciplines = form.querySelectorAll(`[data-list=\"${action}\"] [data-action=\"selectdiscipline\"]`);\n        // Find the discipline in the available disciplines based on the discipline id.\n        const listedDiscipline = Array.from(availableDisciplines).find(d => d.dataset.id == disciplineid);\n        if (!listedDiscipline || listedDiscipline.textContent !== disciplinename) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('invalidinput', 'customfield_sprogramme');\n            return false;\n        }\n        const displine = {\n            id: disciplineid,\n            name: disciplinename,\n            percentage: parseInt(disciplinevalue),\n        };\n        // Return a promise.\n        return new Promise((resolve) => {\n            resolve(displine);\n        });\n    }\n\n    /**\n     * Load the discipline in the form.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    loadDiscipline(btn) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        form.querySelector('#discipline-id').value = btn.dataset.id;\n        form.querySelector('#discipline-name').value = btn.dataset.name;\n        form.querySelector('#discipline-value').value = btn.dataset.percentage;\n        form.querySelector('#discipline-value').focus();\n    }\n\n    /**\n     * Show the changes.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async showchanges(btn) {\n        // Remove the active class from all buttons.\n        const tds = document.querySelectorAll('[data-action=\"showchanges\"]');\n        tds.forEach(td => {\n            if (td !== btn) {\n                td.classList.remove('active');\n            }\n        });\n        // Add the active class to the clicked button.\n        btn.classList.add('active');\n    }\n\n    /**\n     * Accept the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async acceptRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.acceptRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Reject the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async rejectRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.rejectRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Submit the RFC for approval.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async submitRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.submitRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Cancel the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async cancelRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.cancelRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Remove the RFC.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeRfc(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        const response = await Repository.removeRfc({courseid: this.courseid, userid: userid});\n        if (response) {\n            this.getTableData();\n        }\n    }\n\n    /**\n     * Augment the table.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async augmentTable(btn) {\n        const userid = btn.closest('[data-rfc]').dataset.userid;\n        // Find all cells with data-action=\"showchanges\"\n        // Find the input in this cell\n        // Disable the input by changing data-input=\"auto\" to data-input=\"rfc\"\n        // Find the changesdiv in this cell with [data-changes][data-userid=\"userid\"]\n        // get the new value attribute from changesdiv [data-newvalue=\"newvalue\"]\n        // Temporarly set the input value for the cell to the new value. Store the old value in a data-attribute.\n        const form = document.querySelector('[data-region=\"app\"]');\n        const resetRfc = form.querySelector('[data-action=\"resetrfc\"]');\n        this.resetRfc(resetRfc);\n        resetRfc.classList.remove('d-none');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        window.console.log(changeCells);\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"auto\"]');\n            if (input) {\n                input.dataset.input = 'rfc';\n                const changesdiv = cell.querySelector('[data-changes][data-userid=\"' + userid + '\"]');\n                if (!changesdiv) {\n                    return;\n                }\n                const newvalue = changesdiv.dataset.newvalue;\n                input.dataset.oldvalue = input.value;\n                input.value = newvalue;\n                cell.classList.add('rfc');\n            }\n        });\n        this.sumtotals();\n    }\n\n    /**\n     * Reset the table to the original state.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async resetRfc(btn) {\n        const form = document.querySelector('[data-region=\"app\"]');\n        const changeCells = form.querySelectorAll('[data-action=\"showchanges\"]');\n        changeCells.forEach(cell => {\n            const input = cell.querySelector('[data-input=\"rfc\"]');\n            if (input) {\n                input.dataset.input = 'auto';\n                input.value = input.dataset.oldvalue;\n                cell.classList.remove('rfc');\n            }\n        });\n        this.sumtotals();\n        btn.classList.add('d-none');\n    }\n\n    /**\n     * Disable the form input if the maximum number of disciplines is reached.\n     * @param {object} form The form.\n     * @return {void}\n     */\n    async disableFormInput(form) {\n        const action = form.dataset.action;\n        const rowid = form.querySelector('#rowid').value;\n        const row = this.getRow(rowid);\n        if ((action === 'data-disciplines' && row.disciplines.length >= 3) ||\n            (action === 'data-competencies' && row.competencies.length >= 300)) {\n            form.querySelector('input[type=\"search\"]').disabled = true;\n            form.querySelector('input[type=\"number\"]').disabled = true;\n            form.querySelector('button[data-action=\"discipline-confirm\"]').disabled = true;\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('maxdisciplines', 'customfield_sprogramme', 3);\n        } else {\n            form.querySelector('input[type=\"search\"]').disabled = false;\n            form.querySelector('input[type=\"number\"]').disabled = false;\n            form.querySelector('button[data-action=\"discipline-confirm\"]').disabled = false;\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = '';\n        }\n    }\n\n    // Add a discipline to the row.\n    async addDiscipline() {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const action = form.dataset.action;\n        const discipline = await this.getSelectedDiscipline(form);\n        if (!discipline) {\n            return;\n        }\n        const rowid = form.querySelector('#rowid').value;\n        const row = this.getRow(rowid);\n        // Update or add the discipline to the row.\n        const containername = action === 'data-disciplines' ? 'container-disciplines' : 'container-competencies';\n        let disciplineIndex = 0;\n        let maxpercentage = 100;\n        if (action === 'data-disciplines') {\n            disciplineIndex = row.disciplines.findIndex(d => d.id == discipline.id);\n            maxpercentage = 100 - row.disciplines.reduce((acc, comp) => acc + parseInt(comp.percentage), 0);\n        }\n        if (action === 'data-competencies') {\n            disciplineIndex = row.competencies.findIndex(d => d.id == discipline.id);\n            maxpercentage = 100 - row.competencies.reduce((acc, disc) => acc + parseInt(disc.percentage), 0);\n        }\n        if (discipline.percentage > maxpercentage) {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML =\n                await getString('maxpercentage', 'customfield_sprogramme', maxpercentage);\n            return;\n        } else {\n            form.querySelector('[data-region=\"warnings\"]').innerHTML = '';\n        }\n        const container = document.querySelector(\n            `[${action}][data-rowid=\"${rowid}\"] [data-region=\"${containername}\"]`);\n        const selectedcontainer = form.querySelector('[data-region=\"selected-disciplines\"]');\n        if (disciplineIndex > -1) {\n            if (action === 'data-disciplines') {\n                row.disciplines[disciplineIndex] = discipline;\n            }\n            if (action === 'data-competencies') {\n                row.competencies[disciplineIndex] = discipline;\n            }\n            const rendered = container.querySelector('[data-id=\"' + discipline.id + '\"]');\n            const selected = selectedcontainer.querySelector('[data-id=\"' + discipline.id + '\"]');\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            await Templates.replaceNode(rendered, html, js);\n            await Templates.replaceNode(selected, html, js);\n\n        } else {\n            if (action === 'data-disciplines') {\n                row.disciplines.push(discipline);\n            }\n            if (action === 'data-competencies') {\n                row.competencies.push(discipline);\n            }\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            await Templates.appendNodeContents(container, html, js);\n            await Templates.appendNodeContents(selectedcontainer, html, js);\n        }\n        this.disableFormInput(form);\n        this.setTableData();\n    }\n\n    /**\n     * Render the disciplines in the form.\n     * @param {int} rowid The rowid.\n     * @param {String} region The region.\n     * @return {void}\n     */\n    async renderFormDisciplines(rowid, region) {\n        const row = this.getRow(rowid);\n        let disciplines = [];\n        if (region === 'data-disciplines') {\n            disciplines = row.disciplines;\n        }\n        if (region === 'data-competencies') {\n            disciplines = row.competencies;\n        }\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const container = form.querySelector('[data-region=\"selected-disciplines\"]');\n        container.innerHTML = '';\n        disciplines.forEach(async(discipline) => {\n            const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/discipline', discipline);\n            Templates.appendNodeContents(container, html, js);\n        });\n    }\n\n    /**\n     * Remove a discipline from the row.\n     * @param {object} btn The button that was clicked.\n     * @return {void}\n     */\n    async removeDiscipline(btn) {\n        const form = document.querySelector('[data-region=\"disciplineform\"]');\n        const action = form.dataset.action;\n        const containername = action === 'data-disciplines' ? 'container-disciplines' : 'container-competencies';\n        const rowid = form.querySelector('#rowid').value;\n        const disciplineid = btn.closest('[data-id]').dataset.id;\n\n        // Remove the discipline from the row.\n        if (action === 'data-disciplines') {\n            const row = this.getRow(rowid);\n            const index = row.disciplines.findIndex(d => d.id == disciplineid);\n            row.disciplines.splice(index, 1);\n        }\n        if (action === 'data-competencies') {\n            const row = this.getRow(rowid);\n            const index = row.competencies.findIndex(d => d.id == disciplineid);\n            row.competencies.splice(index, 1);\n        }\n\n        // Remove the discipline/competency from the view.\n        const container = document.querySelector(\n            `[${action}][data-rowid=\"${rowid}\"] [data-region=\"${containername}\"]`);\n        const selectedcontainer = document.querySelector('[data-region=\"selected-disciplines\"]');\n        const discipline = container.querySelector('[data-id=\"' + disciplineid + '\"]');\n        const selected = selectedcontainer.querySelector('[data-id=\"' + disciplineid + '\"]');\n        container.removeChild(discipline);\n        selectedcontainer.removeChild(selected);\n        this.disableFormInput(form);\n        this.setTableData();\n    }\n\n    /**\n     * Navigate to the next or previous row and left or right column.\n     * @param {Event} e The event.\n     * @return {void}\n     */\n    navigate(e) {\n        const currentIndex = e.target.closest('[data-row]').dataset.index;\n        const currentColumn = e.target.closest('[data-cell]').dataset.columnid;\n        const allRows = document.querySelectorAll('[data-row]');\n        for (let i = 0; i < allRows.length; i++) {\n            if (allRows[i].dataset.index == currentIndex) {\n                if (e.key === 'ArrowDown' && i < allRows.length - 1) {\n                    const nextInput = allRows[i + 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (nextInput) {\n                        nextInput.focus();\n                    }\n                }\n                if (e.key === 'ArrowUp' && i > 0) {\n                    const previousInput = allRows[i - 1].querySelector(`[data-columnid=\"${currentColumn}\"] input`);\n                    if (previousInput) {\n                        previousInput.focus();\n                    }\n                }\n            }\n        }\n        // This part is not working yet, it might not be accessible.\n        if (e.key === 'ArrowRight') {\n            const nextColumn = e.target.closest('[data-cell]').nextElementSibling;\n            if (nextColumn) {\n                nextColumn.focus();\n            }\n        }\n        if (e.key === 'ArrowLeft') {\n            const previousColumn = e.target.closest('[data-cell]').previousElementSibling;\n            if (previousColumn) {\n                previousColumn.focus();\n            }\n        }\n    }\n}\n\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n */\nconst init = (element, courseid) => {\n    new Manager(element, courseid);\n};\n\nexport default {\n    init: init,\n};"],"names":["Manager","constructor","element","courseid","parseInt","addEventListeners","getDatagrid","form","document","querySelector","addEventListener","e","btn","target","closest","preventDefault","actions","querySelectorAll","forEach","td","classList","remove","input","change","modulename","changeModule","key","navigate","dragging","isDraggingAllowed","tagName","effectAllowed","parentNode","dataset","region","rect","getBoundingClientRect","clientY","top","height","insertBefore","nextSibling","rowId","index","prevRowId","previousElementSibling","moduleId","id","updateSortOrder","type","this","moduleid","previd","typeahead","setTableData","getTableData","getTableConfig","response","Repository","getColumns","State","setValue","columns","getData","showrfc","modules","length","parseModules","rfcs","createModule","createRow","error","exception","mod","rows","map","row","cells","cell","column","find","Object","assign","options","option","clonedOption","name","value","selected","edit","getRowObject","checkCellValue","substring","cleanModules","cleanedModules","module","rowObject","cleanedRows","cleanedRow","keys","cleanedCell","disciplines","discipline","cleanedDiscipline","competencies","competency","cleanedCompetency","cleanedModule","sortorder","modulesortorder","push","async","saveConfirmButton","warnings","add","getValue","setData","window","console","log","data","innerHTML","setTimeout","set","actionMap","addRow","deleteRow","addModule","deleteModule","showDisciplineForm","removeDiscipline","closeDisciplineForm","textContent","setDisciplineForm","addDiscipline","loadDiscipline","showchanges","acceptRfc","rejectRfc","submitRfc","cancelRfc","removeRfc","augmentTable","resetRfc","action","call","rowid","m","splice","indexOf","r","prevrowid","Promise","resolve","undefined","structuredClone","Array","from","children","resetRowSortorder","group","columnid","rowIndex","findIndex","cellIndex","c","sumtotals","sum","parseFloat","getRow","reduce","acc","concat","mindex","removeMatchBold","toLowerCase","includes","makeMatchBold","text","first","slice","match","last","btnAction","arrow","rowArray","setindex","attachTo","attachToButton","appendChild","rectBtn","rectAttachToButton","style","renderFormDisciplines","disableFormInput","container","formFieldSearch","formFieldValue","formFieldDiscipline","formFieldDisciplineName","formFieldLastIds","lastIds","split","join","focus","disciplineid","disciplinevalue","disciplinename","availableDisciplines","listedDiscipline","d","displine","percentage","userid","changeCells","changesdiv","newvalue","oldvalue","disabled","getSelectedDiscipline","containername","disciplineIndex","maxpercentage","comp","disc","selectedcontainer","rendered","html","js","Templates","renderForPromise","replaceNode","appendNodeContents","removeChild","currentIndex","currentColumn","allRows","i","nextInput","previousInput","nextColumn","nextElementSibling","previousColumn","init"],"mappings":"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"}