{"version":3,"file":"formfield.min.js","sources":["../src/formfield.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module formfield\n *\n * @module     customfield_sprogramme/formfield\n * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Manager from 'customfield_sprogramme/manager';\nimport History from 'customfield_sprogramme/history';\nimport Templates from 'core/templates';\nimport {getString} from 'core/str';\nimport Modal from 'core/modal';\nimport ModalEvents from 'core/modal_events';\nimport Repository from 'customfield_sprogramme/local/repository';\n/*\n * Initialise\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n */\nconst init = async() => {\n    document.addEventListener('click', async(event) => {\n        const editaction = event.target.closest('[data-action=\"editprogramme\"]');\n        if (editaction) {\n            const courseid = editaction.dataset.courseid;\n            await getEditor(editaction, courseid);\n            event.preventDefault();\n        }\n        const submittedaction = event.target.closest('[data-action=\"showrfc-submitted\"]');\n        if (submittedaction) {\n            const courseid = submittedaction.dataset.courseid;\n            await getEditor(submittedaction, courseid);\n            event.preventDefault();\n        }\n        const acceptedaction = event.target.closest('[data-action=\"showrfc-accepted\"]');\n        if (acceptedaction) {\n            const courseid = acceptedaction.dataset.courseid;\n            const adminid = acceptedaction.dataset.adminid;\n            await showHistory(acceptedaction, courseid, adminid);\n            event.preventDefault();\n        }\n    });\n};\n\nconst showHistory = async(element, courseid, rfcid) => {\n    await getProgrammeHistory(element, courseid, rfcid);\n    const modalContent = document.querySelector('[data-region=\"history\"]');\n\n    const modal = await Modal.create({\n        large: true,\n        title: getString('history', 'customfield_sprogramme'),\n        body: modalContent,\n        show: true,\n    });\n    const modalElement = modal.getModal()[0];\n    modalElement.classList.add('modal-customfield_sprogramme_history');\n};\n\nconst getEditor = async(element, courseid) => {\n    await getProgramme(element, courseid);\n    const modalContent = document.querySelector('[data-region=\"app\"]');\n\n    const modal = await Modal.create({\n        large: true,\n        title: getString('editprogramme', 'customfield_sprogramme'),\n        body: modalContent,\n        show: true,\n    });\n\n    modal.getRoot().on(ModalEvents.hidden, async() => {\n        // Trigger the Manager save all event, this ensures all inputs are saved\n        // when the modal is closed.\n        const saveEvent = new CustomEvent('saveprogrammconfirm', {bubbles: true});\n        document.dispatchEvent(saveEvent);\n    });\n\n    const saveButton = document.createElement('div');\n    const modalElement = modal.getModal()[0];\n    modalElement.classList.add('modal-customfield_sprogramme_editor');\n    const header = modalElement.querySelector('[data-region=\"header\"]');\n    const title = modalElement.querySelector('[data-region=\"title\"]');\n    if (title) {\n        // Add the icone after the title Element.\n        header.insertBefore(saveButton, title.nextSibling);\n    }\n\n    const {html, js} = await Templates.renderForPromise('customfield_sprogramme/table/savebutton', {courseid: courseid});\n    await Templates.replaceNode(saveButton, html, js);\n    const closeButton = header.querySelector('[data-action=\"closeform\"]');\n    closeButton.addEventListener('click', () => {\n        modal.hide();\n    });\n    const downloadButton = header.querySelector('[data-action=\"programme-download-csv\"]');\n    downloadButton.addEventListener('click', async(event) => {\n        downloadCSV(courseid);\n        event.preventDefault();\n    });\n    const renderedSaveButton = header.querySelector('[data-action=\"saveconfirm\"]');\n    renderedSaveButton.addEventListener('click', async(event) => {\n        // Run the 'saveconfirm' custom event.\n        const saveEvent = new CustomEvent('saveconfirm', {bubbles: true});\n        document.dispatchEvent(saveEvent);\n        event.preventDefault();\n    });\n};\n\nconst downloadCSV = async(courseid) => {\n    const csv = await Repository.csvData({courseid: courseid});\n    const blob = new Blob([csv.csv], {type: 'text/csv'});\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = csv.filename;\n    a.click();\n    window.URL.revokeObjectURL(url);\n};\n\n\n/**\n * Get the programme.\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n * @return {Promise} The programme.\n */\nconst getProgramme = async(element, courseid) => {\n    Manager.init(element, courseid);\n};\n\n/**\n * Get the programme history.\n * @param {HTMLElement} element The element.\n * @param {String} courseid The courseid.\n * @param {String} rfcid The rfcid.\n * @return {Promise} The programme history.\n */\nconst getProgrammeHistory = async(element, courseid, rfcid) => {\n    History.init(element, courseid, rfcid);\n};\n\n\nexport default {\n    init: init,\n};"],"names":["showHistory","async","element","courseid","rfcid","getProgrammeHistory","modalContent","document","querySelector","Modal","create","large","title","body","show","getModal","classList","add","getEditor","getProgramme","modal","getRoot","on","ModalEvents","hidden","saveEvent","CustomEvent","bubbles","dispatchEvent","saveButton","createElement","modalElement","header","insertBefore","nextSibling","html","js","Templates","renderForPromise","replaceNode","addEventListener","hide","downloadCSV","event","preventDefault","csv","Repository","csvData","blob","Blob","type","url","window","URL","createObjectURL","a","href","download","filename","click","revokeObjectURL","init","editaction","target","closest","dataset","submittedaction","acceptedaction","adminid"],"mappings":";;;;;;;uWA0DMA,YAAcC,MAAMC,QAASC,SAAUC,eACnCC,oBAAoBH,QAASC,SAAUC,aACvCE,aAAeC,SAASC,cAAc,kCAExBC,eAAMC,OAAO,CAC7BC,OAAO,EACPC,OAAO,kBAAU,UAAW,0BAC5BC,KAAMP,aACNQ,MAAM,KAEiBC,WAAW,GACzBC,UAAUC,IAAI,yCAGzBC,UAAYjB,MAAMC,QAASC,kBACvBgB,aAAajB,QAASC,gBACtBG,aAAeC,SAASC,cAAc,uBAEtCY,YAAcX,eAAMC,OAAO,CAC7BC,OAAO,EACPC,OAAO,kBAAU,gBAAiB,0BAClCC,KAAMP,aACNQ,MAAM,IAGVM,MAAMC,UAAUC,GAAGC,sBAAYC,QAAQvB,gBAG7BwB,UAAY,IAAIC,YAAY,sBAAuB,CAACC,SAAS,IACnEpB,SAASqB,cAAcH,oBAGrBI,WAAatB,SAASuB,cAAc,OACpCC,aAAeX,MAAML,WAAW,GACtCgB,aAAaf,UAAUC,IAAI,6CACrBe,OAASD,aAAavB,cAAc,0BACpCI,MAAQmB,aAAavB,cAAc,yBACrCI,OAEAoB,OAAOC,aAAaJ,WAAYjB,MAAMsB,mBAGpCC,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAAiB,0CAA2C,CAACnC,SAAUA,iBACpGkC,mBAAUE,YAAYV,WAAYM,KAAMC,IAC1BJ,OAAOxB,cAAc,6BAC7BgC,iBAAiB,SAAS,KAClCpB,MAAMqB,UAEaT,OAAOxB,cAAc,0CAC7BgC,iBAAiB,SAASvC,MAAAA,QACrCyC,YAAYvC,UACZwC,MAAMC,oBAEiBZ,OAAOxB,cAAc,+BAC7BgC,iBAAiB,SAASvC,MAAAA,cAEnCwB,UAAY,IAAIC,YAAY,cAAe,CAACC,SAAS,IAC3DpB,SAASqB,cAAcH,WACvBkB,MAAMC,qBAIRF,YAAczC,MAAAA,iBACV4C,UAAYC,oBAAWC,QAAQ,CAAC5C,SAAUA,WAC1C6C,KAAO,IAAIC,KAAK,CAACJ,IAAIA,KAAM,CAACK,KAAM,aAClCC,IAAMC,OAAOC,IAAIC,gBAAgBN,MACjCO,EAAIhD,SAASuB,cAAc,KACjCyB,EAAEC,KAAOL,IACTI,EAAEE,SAAWZ,IAAIa,SACjBH,EAAEI,QACFP,OAAOC,IAAIO,gBAAgBT,MAUzBhC,aAAelB,MAAMC,QAASC,6BACxB0D,KAAK3D,QAASC,WAUpBE,oBAAsBJ,MAAMC,QAASC,SAAUC,0BACzCyD,KAAK3D,QAASC,SAAUC,qBAIrB,CACXyD,KAzHS5D,UACTM,SAASiC,iBAAiB,SAASvC,MAAAA,cACzB6D,WAAanB,MAAMoB,OAAOC,QAAQ,oCACpCF,WAAY,OACN3D,SAAW2D,WAAWG,QAAQ9D,eAC9Be,UAAU4C,WAAY3D,UAC5BwC,MAAMC,uBAEJsB,gBAAkBvB,MAAMoB,OAAOC,QAAQ,wCACzCE,gBAAiB,OACX/D,SAAW+D,gBAAgBD,QAAQ9D,eACnCe,UAAUgD,gBAAiB/D,UACjCwC,MAAMC,uBAEJuB,eAAiBxB,MAAMoB,OAAOC,QAAQ,uCACxCG,eAAgB,OACVhE,SAAWgE,eAAeF,QAAQ9D,SAClCiE,QAAUD,eAAeF,QAAQG,cACjCpE,YAAYmE,eAAgBhE,SAAUiE,SAC5CzB,MAAMC"}