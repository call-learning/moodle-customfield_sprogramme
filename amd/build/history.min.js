define("customfield_sprogramme/history",["exports","customfield_sprogramme/local/state","customfield_sprogramme/local/repository","core/pending","core/notification","./local/components/history"],(function(_exports,_state,_repository,_pending,_notification,_history){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module history
   *
   * @module     customfield_sprogramme/history
   * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_state=_interopRequireDefault(_state),_repository=_interopRequireDefault(_repository),_pending=_interopRequireDefault(_pending),_notification=_interopRequireDefault(_notification),_history=_interopRequireDefault(_history);class History{constructor(rfcid,datafieldid){this.rfcid=rfcid,this.datafieldid=datafieldid,this.getProgrammeHistory(),this.addEventListeners()}async getProgrammeHistory(){const context={rfcid:this.rfcid,datafieldid:this.datafieldid};try{const response=await _repository.default.getProgrammeHistory(context);0===response.length&&_state.default.setValue("history",[]);const history={modules:this.parseModules(response),columns:response.columns,rfc:response.rfc};_state.default.setValue("history",history)}catch(error){_notification.default.exception(error)}}parseModules(response){return response.modules.forEach((mod=>{mod.rows.map((row=>(row.cells=row.cells.map((cell=>{const column=response.columns.find((column=>column.column==cell.column));return(cell=Object.assign({},cell,column)).changed=cell.value!==cell.oldvalue,cell})),row)))})),response.modules}addEventListeners(){document.addEventListener("click",(e=>{let btn=e.target.closest(".modal-customfield_sprogramme_history [data-action]");btn&&(e.preventDefault(),this.actions(btn.dataset.action,btn))}))}actions(action,element){const actionMap={acceptrfc:this.acceptRfc,rejectrfc:this.rejectRfc};actionMap[action]&&actionMap[action].call(this,element)}async acceptRfc(btn){const userid=btn.closest("[data-rfc]").dataset.userid;await _repository.default.acceptRfc({datafieldid:this.datafieldid,userid:userid})&&this.getProgrammeHistory()}async rejectRfc(btn){const pending=new _pending.default("customfield_sprogramme/manager:rejectRFC"),userid=btn.closest("[data-rfc]").dataset.userid;await _repository.default.rejectRfc({datafieldid:this.datafieldid,userid:userid})&&this.getProgrammeHistory(),pending.resolve()}}var _default={init:(rfcid,datafieldid)=>((0,_history.default)(),new History(rfcid,datafieldid))};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=history.min.js.map